<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Feature-based Camera Self-Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('calibration_usecase_features.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Feature-based Camera Self-Calibration </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Operating Principle</h1>
<p >The camera's extrinsic pose calibration with respect to the vehicle is represented by both orientation and position parameters.</p>
<p >Orientation parameters are pitch and roll with respect to a nominal ground plane, and yaw with respect to the car's forward direction. The camera's pitch and yaw orientation components are crucial for lane-holding, where the accuracy requirements are such that relying only on factory calibration is unrealistic. Pitch and roll are important for, e.g., distance estimation and ground plane projections. In a similar way, the camera's height is crucial for map generation of road markings on the ground.</p>
<p >NVIDIA<sup>&reg;</sup> DriveWorks uses visually tracked features to estimate camera motion and calibrate the camera's full orientation and height component in a self-calibration setting. Pitch and yaw are calibrated simultaneously by comparing the translation direction obtained from the visual motion and the car's egomotion. Likewise, roll is calibrated by matching estimated angular motion of the camera with the car's egomotion, and requires turn maneuvers to be estimated. In addition, visually tracked and triangulated features on the ground plane next to the car are used to estimate the height component of the camera's position relative to the car.</p>
<h2>Camera Motion Estimation</h2>
<p >Camera motion estimation is performed by considering a pair of images and minimizing the epipolar-based error of it's tracked features. The calibration engine receives feature tracks for each frame and it will decide which image pairs are suitable for calibration. This results in camera motion in form of a rigid transformation (rotation and translation direction) between the camera at two points in time.</p>
<h2>Camera Roll / Pitch / Yaw / Height</h2>
<p >The visual motion obtained in the previous step is compared to the motion of the car (estimated by the egomotion module). Using the well-known hand-eye constraint, the relative transformation between the camera and the car is estimated. This relative transform provides the pitch and yaw of the camera. Turning car motion constraints the roll of the camera. Additionally, the camera motion is used to triangulate feature tracks on the ground next to the car, from which the camera's height is inferred.</p>
<p >The instantaneous calibration for an image pair is accumulated in histograms for the calibration's roll, pitch, yaw, and height components to estimate a final calibration in a robust way.</p>
<div class="image">
<img src="self_calib_camera_feature_roll_pitch_yaw_height.png" alt=""/>
<div class="caption">
Tracked features image (top), roll/pitch/yaw/height histograms of a feature-calibrated camera (bottom), collected over a period of time. The nominal calibration is indicated by blue horizon/forward directions, the corrected calibration by green indicators</div></div>
    <h1>Requirements</h1>
<h2>Initialization Requirements</h2>
<ul>
<li>Nominal values on camera calibration<ul>
<li>Orientation(roll/pitch/yaw): roll/pitch/yaw less than 5 degree error</li>
<li>Position(x/y/z): less than 10 mm</li>
<li>Intrinsic calibration: accurate to 0.5 pixel</li>
</ul>
</li>
</ul>
<h2>Runtime Calibration Dependencies</h2>
<ul>
<li>Any height calibration: absolute scale is inferred from egomotion, which needs to use calibrated odometry properties (e.g., wheel radii via radar self-calibration)</li>
<li>Side-camera roll calibration: side-camera roll is inferred from egomotion's axis of rotation, which needs to be based on an accurate IMU calibration</li>
</ul>
<h2>Input Requirements</h2>
<ul>
<li>Assumption: feature tracks compatible with DriveWork's module <a class="el" href="imageprocessing_features_mainsection.html">Features</a></li>
<li>Vehicle egomotion: requirements can be found in the <a class="el" href="egomotion_mainsection.html">Egomotion</a> module</li>
</ul>
<h2>Output Requirements</h2>
<ul>
<li>Corrected calibration for pitch/yaw (mandatory) and roll/height (optionally, if requested by user)</li>
<li>Correction accuracy:<ul>
<li>pitch/yaw: less than 0.20deg error</li>
<li>roll: less than 0.25deg error</li>
<li>height: less than 3cm error</li>
</ul>
</li>
<li>Time/Events to correction:<ul>
<li>pitch/yaw: less than 1:44 minutes in 75% of the cases, less than 3:30 minutes in 100% of the cases</li>
<li>roll: correction depends on turning motion, and requires less than four strong turns in 75% of the cases, and less than six strong turns in 100% of the cases</li>
<li>height: less than 2:41 minutes in 75% of the cases, less than 4:15 minutes in 100% of the cases</li>
</ul>
</li>
</ul>
<h1>Cross-validation KPI</h1>
<p >Several hours of data are used to produce a reference calibration value for cross-validation. Then, short periods of data are evaluated for whether they can recover the same values. For example, the graph below shows precision/recall curves of motion-based camera roll/pitch/yaw/height self-calibration. Precision indicates that an accepted calibration is within a fixed precision threshold from the reference calibration, and recall indicates the ratio of accepted calibrations in the given amount of time.</p>
<div class="image">
<img src="self_calib_camera_feature_roll_pitch_yaw_height_kpi.png" alt=""/>
</div>
    <h1>Workflow</h1>
<p >The following code snippet shows the general structure of a program that performs camera self-calibration</p>
<div class="fragment"><div class="line">dwFeatureListHandle_t featureListHandle;   <span class="comment">// used by the features module</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a>(...);       <span class="comment">// depends on sensor from rig configuration module</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#gab3336e08f14b7f6a857988a8657b39da">dwCalibrationEngine_initializeCamera</a>(...); <span class="comment">// depends on nominal calibration from rig configuration. Estimated signals (roll/pitch/yaw/height) can be selected here</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a>(...); <span class="comment">// runtime calibration dependencies need to be met</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(<span class="keyword">true</span>) <span class="comment">// main loop</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// track features for current camera frame</span></div>
<div class="line">    dwFeatureTracker_trackFeatures(featureListHandle, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get feature tracks</span></div>
<div class="line">    dwFeatureListPointers featureDataGPU;</div>
<div class="line">    dwFeatureList_getDataPointers(&amp;featureDataGPU, ..., featureListHandle); <span class="comment">// requires features module</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// feed feature tracks into self-calibration</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga680ce1c65c11cd40f2fdf0e1e2186f45">dwCalibrationEngine_addFeatureDetections</a>(..., featureDataGPU.featureCount, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve calibration status</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a>(...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve self-calibration results</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga95508c9a4e225e566dc21ca265672ac7">dwCalibrationEngine_getSensorToRigTransformation</a>(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a>(...);</div>
<div class="ttc" id="agroup__calibration__group_html_ga3ec3a048d476315d0debab207f5da156"><div class="ttname"><a href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getCalibrationStatus(dwCalibrationStatus *status, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current status of a calibration routine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga680ce1c65c11cd40f2fdf0e1e2186f45"><div class="ttname"><a href="group__calibration__group.html#ga680ce1c65c11cd40f2fdf0e1e2186f45">dwCalibrationEngine_addFeatureDetections</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_addFeatureDetections(uint32_t featureCapacity, uint32_t historyCapacity, const uint32_t *d_featureCount, const uint32_t *d_ages, const dwVector2f *d_locationHistory, const dwFeature2DStatus *d_featureStatuses, uint32_t currentTimeIdx, dwTime_t timestamp, uint32_t sensorIndex, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Adds detected visual features to the calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga92ee0458420c6d398d3871303de98973"><div class="ttname"><a href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initialize(dwCalibrationEngineHandle_t *engine, dwRigHandle_t rig, dwContextHandle_t context)</div><div class="ttdoc">Creates and initializes a Calibration Engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga95508c9a4e225e566dc21ca265672ac7"><div class="ttname"><a href="group__calibration__group.html#ga95508c9a4e225e566dc21ca265672ac7">dwCalibrationEngine_getSensorToRigTransformation</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getSensorToRigTransformation(dwTransformation3f *sensorToRig, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current sensor to rig transformation of a calibration routine estimating this transformat...</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga9a509def08788c1876c8af2000af83ce"><div class="ttname"><a href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_startCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Starts a calibration routine associated with a calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gab3336e08f14b7f6a857988a8657b39da"><div class="ttname"><a href="group__calibration__group.html#gab3336e08f14b7f6a857988a8657b39da">dwCalibrationEngine_initializeCamera</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initializeCamera(dwCalibrationRoutineHandle_t *routine, uint32_t sensorIndex, const dwCalibrationCameraParams *params, dwEgomotionConstHandle_t egomotion, cudaStream_t stream, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Initializes a camera calibration routine designated by the sensor provided to the method.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gae4948b8898f6085b079670e049982e93"><div class="ttname"><a href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_stopCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Stops a calibration routine associated with a calibration engine.</div></div>
</div><!-- fragment --><p >This workflow is demonstrated in the following sample: <a class="el" href="dwx_camera_calibration_sample.html">Camera Calibration Sample</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
