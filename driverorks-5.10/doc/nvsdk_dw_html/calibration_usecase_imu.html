<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: IMU Self-Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('calibration_usecase_imu.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IMU Self-Calibration </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>IMU Calibration - Operating Principle</h1>
<p >IMU calibration involves the estimation of the three angles aligning the IMU coordinate frame to the vehicle coordinate frame: roll, pitch, and yaw. All three angles are crucial to correctly estimate and predict the vehicle's pose when egomotion is used in <code><a class="el" href="group__egomotion__group.html#gga83a421afa3cf1c31a1efcd64c0ee2270ac2e1e298a27c251aeecd98c0dfe9ab84" title="Fuses odometry model with IMU measurements to estimate motion of the vehicle.">DW_EGOMOTION_IMU_ODOMETRY</a></code> mode (for more details, see <a class="el" href="egomotion_mainsection.html">Egomotion</a>). The three angles are computed by processing the data sensed by the linear accelerometer and the gyroscope sensors embedded in the IMU device. Common driving maneuvers must be performed in order to excite the accelerometer and the gyroscope sensors along their three axes in order to make all three angles to be estimated observable.</p>
<h2>IMU Roll</h2>
<p >In order to calibrate the IMU roll, the vehicle must perform several turns. Turns are automatically detected by the magnitude of the gyroscope excitation. In order to mitigate the influence of sensor noise, the gyroscope data is smoothed prior to processing. Roll corresponding to the gyroscope rotation is sampled into a histogram, mode of which, defines the estimated roll angle.</p>
<h2>IMU Pitch and Yaw</h2>
<p >The pitch and yaw of the IMU are computed by using the linear accelerometer. In order to identify a forward acceleration, episodes of starts from static conditions, e.g, restarting at a traffic light or in a traffic jam, are automatically detected. In order to mitigate the influence of sensor noise, the accelerometer data is smoothed prior to processing. Employing the same histogram voting scheme as before, the pitch and yaw calibration angles are estimated in a robust way (see histograms below).</p>
<div class="image">
<img src="self_calib_imu.png" alt=""/>
<div class="caption">
Up estimation histograms (left) and forward estimation histograms (right) of an IMU calibration, collected over a period of time</div></div>
    <h1>Requirements</h1>
<h2>Initialization Requirements</h2>
<ul>
<li>Nominal values on IMU calibration<ul>
<li>Orientation(roll/pitch/yaw): roll less than 10 degree error, pitch and yaw less than 5 degree error</li>
<li>Position(x/y/z): not used</li>
</ul>
</li>
</ul>
<h2>Runtime Calibration Dependencies</h2>
<ul>
<li>None</li>
</ul>
<h2>Input Requirements</h2>
<ul>
<li>Assumption: Vehicle performs the aforementioned maneuvers until calibration convergence.</li>
<li>Speed measurements: Must be provided as part of <a class="el" href="group__VehicleIO__actuators__group.html#structdwVehicleIOState" title="The vehicle IO state data.">dwVehicleIOState</a>, see <a class="el" href="vehicleio_mainsection.html">VehicleIO</a> for details</li>
</ul>
<h2>Output Requirements</h2>
<ul>
<li>Corrected roll/pitch/yaw value: less than 0.4 degrees accuracy</li>
<li>Time to correction: 11 minutes</li>
</ul>
<h1>Cross-validation KPI</h1>
<p >Several hours of data are used to produce a reference calibration value for cross-validation. Then, short periods of data are evaluated for whether they can recover the same values. For example, the graph below shows precision/recall curves of IMU self-calibration. Precision indicates that an accepted calibration is within a fixed precision threshold from the reference calibration, and recall indicates the ratio of accepted calibrations in the given amount of time.</p>
<div class="image">
<img src="self_calib_imu_kpi.png" alt=""/>
</div>
    <h1>Workflow</h1>
<p >The following code snippet shows the general structure of a program that performs IMU self-calibration</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a>(...);       <span class="comment">// depends on sensor from rig configuration module</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#gae5bcba81cb650e02384e5439b6f601e8">dwCalibrationEngine_initializeIMU</a>(...);    <span class="comment">// depends on nominal calibration from rig configuration</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a>(...); <span class="comment">// runtime calibration dependencies need to be met</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(<span class="keyword">true</span>) <span class="comment">// main loop</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// get current IMU frame</span></div>
<div class="line">    <a class="code hl_function" href="group__imu__group.html#ga5d787e68b8bfb76838105bb14977e06b">dwSensorIMU_readFrame</a>(&amp;imuFrame, ...); <span class="comment">// requires IMU module</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// feed IMU frame into self-calibration</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga6bcc5dd7097cf367b050446b0eba4dc5">dwCalibrationEngine_addIMUFrame</a>(&amp;imuFrame, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update vehicle state from CAN</span></div>
<div class="line">    <a class="code hl_function" href="group__can__group.html#gad6d8c00535c550d544534122303cec1a">dwSensorCAN_readMessage</a>(&amp;canMsg, ...);</div>
<div class="line">    <a class="code hl_function" href="group__VehicleIO__actuators__group.html#gadb4a97bea2caeb409b783d5e6d62d938">dwVehicleIO_consumeCANFrame</a>(&amp;canMsg, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get current vehicle state</span></div>
<div class="line">    <a class="code hl_function" href="group__VehicleIO__actuators__group.html#ga64226a58a43467a8c469b4e2fa2e33d9">dwVehicleIO_getVehicleNonSafetyState</a>(&amp;vehicleIONonSafetyState, ...);</div>
<div class="line">    <a class="code hl_function" href="group__VehicleIO__actuators__group.html#ga1de5cf6fa7553c80387d7febeb3c2e42">dwVehicleIO_getVehicleActuationFeedback</a>(&amp;vehicleIOActuationFeedback, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// pass on vehicle state to self-calibration</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga932ecb4e927cb035f2c93a31fc61a10a">dwCalibrationEngine_addVehicleIONonSafetyState</a>(&amp;vehicleIONonSafetyState, ...);</div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga4fbe9193988cf194094749bd7bcd178e">dwCalibrationEngine_addVehicleIOActuationFeedback</a>(&amp;vehicleIOActuationFeedback, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve calibration status</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a>(...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve self-calibration results</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga95508c9a4e225e566dc21ca265672ac7">dwCalibrationEngine_getSensorToRigTransformation</a>(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a>(...);</div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_ga1de5cf6fa7553c80387d7febeb3c2e42"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#ga1de5cf6fa7553c80387d7febeb3c2e42">dwVehicleIO_getVehicleActuationFeedback</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwVehicleIO_getVehicleActuationFeedback(dwVehicleIOActuationFeedback *const actuationFeedback, dwVehicleIOHandle_t const obj)</div><div class="ttdoc">Retrieve current vehicle actuation feedback.</div></div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_ga64226a58a43467a8c469b4e2fa2e33d9"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#ga64226a58a43467a8c469b4e2fa2e33d9">dwVehicleIO_getVehicleNonSafetyState</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwVehicleIO_getVehicleNonSafetyState(dwVehicleIONonSafetyState *const nonSafeState, dwVehicleIOHandle_t const obj)</div><div class="ttdoc">Retrieve current vehicle non-safety state.</div></div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_gadb4a97bea2caeb409b783d5e6d62d938"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#gadb4a97bea2caeb409b783d5e6d62d938">dwVehicleIO_consumeCANFrame</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwVehicleIO_consumeCANFrame(dwCANMessage const *const msg, uint32_t const sensorId, dwVehicleIOHandle_t const obj)</div><div class="ttdoc">Parse a received event.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga3ec3a048d476315d0debab207f5da156"><div class="ttname"><a href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getCalibrationStatus(dwCalibrationStatus *status, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current status of a calibration routine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga4fbe9193988cf194094749bd7bcd178e"><div class="ttname"><a href="group__calibration__group.html#ga4fbe9193988cf194094749bd7bcd178e">dwCalibrationEngine_addVehicleIOActuationFeedback</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_addVehicleIOActuationFeedback(dwVehicleIOActuationFeedback const *vioActuationFeedback, uint32_t sensorIndex, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Adds dwVehicleIOActuationFeedback to calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga6bcc5dd7097cf367b050446b0eba4dc5"><div class="ttname"><a href="group__calibration__group.html#ga6bcc5dd7097cf367b050446b0eba4dc5">dwCalibrationEngine_addIMUFrame</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_addIMUFrame(const dwIMUFrame *imuFrame, uint32_t sensorIndex, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Adds an IMU frame from an IMU sensor to the calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga92ee0458420c6d398d3871303de98973"><div class="ttname"><a href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initialize(dwCalibrationEngineHandle_t *engine, dwRigHandle_t rig, dwContextHandle_t context)</div><div class="ttdoc">Creates and initializes a Calibration Engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga932ecb4e927cb035f2c93a31fc61a10a"><div class="ttname"><a href="group__calibration__group.html#ga932ecb4e927cb035f2c93a31fc61a10a">dwCalibrationEngine_addVehicleIONonSafetyState</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_addVehicleIONonSafetyState(dwVehicleIONonSafetyState const *vioNonSafetyState, uint32_t sensorIndex, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Adds dwVehicleIONonSafetyState to calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga95508c9a4e225e566dc21ca265672ac7"><div class="ttname"><a href="group__calibration__group.html#ga95508c9a4e225e566dc21ca265672ac7">dwCalibrationEngine_getSensorToRigTransformation</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getSensorToRigTransformation(dwTransformation3f *sensorToRig, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current sensor to rig transformation of a calibration routine estimating this transformat...</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga9a509def08788c1876c8af2000af83ce"><div class="ttname"><a href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_startCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Starts a calibration routine associated with a calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gae4948b8898f6085b079670e049982e93"><div class="ttname"><a href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_stopCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Stops a calibration routine associated with a calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gae5bcba81cb650e02384e5439b6f601e8"><div class="ttname"><a href="group__calibration__group.html#gae5bcba81cb650e02384e5439b6f601e8">dwCalibrationEngine_initializeIMU</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initializeIMU(dwCalibrationRoutineHandle_t *routine, const uint32_t imuIndex, const uint32_t canIndex, const dwCalibrationIMUParams *params, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Initializes an IMU calibration routine designated by the sensor provided to the method.</div></div>
<div class="ttc" id="agroup__can__group_html_gad6d8c00535c550d544534122303cec1a"><div class="ttname"><a href="group__can__group.html#gad6d8c00535c550d544534122303cec1a">dwSensorCAN_readMessage</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensorCAN_readMessage(dwCANMessage *const msg, dwTime_t const timeoutUs, dwSensorHandle_t const sensor)</div><div class="ttdoc">Reads a CAN packet with a given timeout from the CAN bus.</div></div>
<div class="ttc" id="agroup__imu__group_html_ga5d787e68b8bfb76838105bb14977e06b"><div class="ttname"><a href="group__imu__group.html#ga5d787e68b8bfb76838105bb14977e06b">dwSensorIMU_readFrame</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensorIMU_readFrame(dwIMUFrame *const frame, dwTime_t const timeoutUs, dwSensorHandle_t const sensor)</div><div class="ttdoc">Reads the next IMU frame from the sensor within a given timeout.</div></div>
</div><!-- fragment --><p >This workflow is demonstrated in the following sample: <a class="el" href="dwx_imu_calibration_sample.html">IMU Calibration Sample</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
