<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Image initialization using PNG file</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_src_dw_image_doc_public_usecase6.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Image initialization using PNG file </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#image_usecase6_initialize_image_from_file">Steps for initializing DW image from an image file</a><ul><li class="level2"><a href="#image_usecase6_initialize_image_from_file_step3">Step  1: Loading a PNG image file</a></li>
<li class="level2"><a href="#image_usecase6_initialize_image_from_file_step1">Step 2: Create a DW image file</a></li>
<li class="level2"><a href="#image_usecase6_initialize_image_from_file_step2">Step  3: Get cuda pointer for image memory</a></li>
<li class="level2"><a href="#image_usecase6_initialize_image_from_file_step4">Step  4: Initialize DW image using pixel data</a></li>
</ul>
</li>
<li class="level1"><a href="#image_usecase6_save_image_to_file">Saving image contents to file</a><ul><li class="level2"><a href="#image_usecase6_save_image_to_file_step1">Step 1: Get image pixels</a></li>
<li class="level2"><a href="#image_usecase6_save_image_to_file_step2">Step 2: Wait for cuda copy to finish</a></li>
<li class="level2"><a href="#image_usecase6_save_image_to_file_step3">Step 3: Save the pixel bytes to PNG file</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="image_usecase6"></a>e</p>
<p >This tutorial demonstrates how to initialize a DW <a class="el" href="image_mainsection.html">Image</a>. A CUDA image is used as an example to show how it can be initialized using pixels obtained from a PNG file and how color pixels can be read from dw image and saved to PNG file. For interacting with PNG files, publicly available lodepng library is used.</p>
<dl class="section note"><dt>Note</dt><dd>1. Lodepng library mentioned in this tutorial is a 3rd party library for PNG image files. Any other library can also be used for PNG or other file formats to load image file with specific format. </dd>
<dd>
2. Refer to public documentation for Lodepng online for more details, error checking etc. </dd>
<dd>
3. This tutorial uses cuda images. NvMedia or CPU images can also be used similarly by using respective APIs to copy pixels. </dd>
<dd>
4. Error checking macros are for illustration purpose and may not actually be part of DW SDK</dd></dl>
<h1><a class="anchor" id="image_usecase6_initialize_image_from_file"></a>
Steps for initializing DW image from an image file</h1>
<h2><a class="anchor" id="image_usecase6_initialize_image_from_file_step3"></a>
Step  1: Loading a PNG image file</h2>
<p >As described below, decode the PNG file to get image attributes and pixel data. These pixels will be used to initialize the DW image and the size(wxh) will be used to allocate DW image in next step. </p><div class="fragment"><div class="line">uint8_t* pBytes = <span class="keyword">nullptr</span>;</div>
<div class="line">uint32_t width        = 0;</div>
<div class="line">uint32_t height       = 0;</div>
<div class="line">uint32_t bitDepth     = 8;</div>
<div class="line">uint32_t decodeRes    = lodepng_decode_file(&amp;pBytes, &amp;width, &amp;height, inFilePath.c_str(), LCT_RGBA, bitDepth);</div>
<div class="line"><span class="keywordflow">if</span> (decodeRes != 0)</div>
<div class="line">{</div>
<div class="line">    std::cerr &lt;&lt;<span class="stringliteral">&quot;: loading png file failed. Error= &quot;</span>&lt;&lt; lodepng_error_text(decodeRes) &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; decodeRes &lt;&lt; <span class="stringliteral">&quot;) \n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="image_usecase6_initialize_image_from_file_step1"></a>
Step 2: Create a DW image file</h2>
<p >Create an image as described <a class="el" href="image_usecase5.html#image_usecase5_basic">here</a> in "Basic Creation". This will allocate memory for the underlying image allocation. </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__image__group.html#structdwImageProperties">dwImageProperties</a> props = {};</div>
<div class="line">props.<a class="code hl_variable" href="group__image__group.html#ab0797520b7b3e416db1cacee3dc4b567">format</a>            = <a class="code hl_enumvalue" href="group__image__group.html#ggab7343d2f61d8450ef8451d4ec73d087ca3bd3c4e72a8ef0652237783a22d1fd29">DW_IMAGE_FORMAT_RGBA_UINT8</a>;</div>
<div class="line">props.<a class="code hl_variable" href="group__image__group.html#a792907e1390890033c22c1865a431c8c">height</a>            = height;</div>
<div class="line">props.<a class="code hl_variable" href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">width</a>             = width;</div>
<div class="line">props.<a class="code hl_variable" href="group__image__group.html#afb91869a17fe8a2657a62f591579742c">memoryLayout</a>      = <a class="code hl_enumvalue" href="group__image__group.html#gga6bc1e1a5e55d1d8fa58e0708c57f973ea7de476aa5d96fa5ecf1e7b21a4268e3a">DW_IMAGE_MEMORY_TYPE_PITCH</a>;</div>
<div class="line">props.<a class="code hl_variable" href="group__image__group.html#a31480af9f96ef640b62acba393f6fc21">type</a>              = <a class="code hl_enumvalue" href="group__image__group.html#gga6623e81a22d553d705467c56ba429c34a4ea518b96c3d6af3a0c77779facbb465">DW_IMAGE_CUDA</a>;</div>
<div class="line">CHECK_AND_HANDLE_ERROR(<a class="code hl_function" href="group__image__group.html#ga8e16c1f43bb5f86cd4dc024d97fd3c5c">dwImage_create</a>(&amp;image, props, sdkContext));</div>
<div class="ttc" id="agroup__image__group_html_a31480af9f96ef640b62acba393f6fc21"><div class="ttname"><a href="group__image__group.html#a31480af9f96ef640b62acba393f6fc21">dwImageProperties::type</a></div><div class="ttdeci">dwImageType type</div><div class="ttdoc">Specifies the type of image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00392">Image.h:392</a></div></div>
<div class="ttc" id="agroup__image__group_html_a792907e1390890033c22c1865a431c8c"><div class="ttname"><a href="group__image__group.html#a792907e1390890033c22c1865a431c8c">dwImageProperties::height</a></div><div class="ttdeci">uint32_t height</div><div class="ttdoc">Specifies the height of the image in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00396">Image.h:396</a></div></div>
<div class="ttc" id="agroup__image__group_html_a9330ab25d52fe131e18e028f429c8fb2"><div class="ttname"><a href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">dwImageProperties::width</a></div><div class="ttdeci">uint32_t width</div><div class="ttdoc">Specifies the width of the image in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00394">Image.h:394</a></div></div>
<div class="ttc" id="agroup__image__group_html_ab0797520b7b3e416db1cacee3dc4b567"><div class="ttname"><a href="group__image__group.html#ab0797520b7b3e416db1cacee3dc4b567">dwImageProperties::format</a></div><div class="ttdeci">dwImageFormat format</div><div class="ttdoc">Specifies the format of the image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00398">Image.h:398</a></div></div>
<div class="ttc" id="agroup__image__group_html_afb91869a17fe8a2657a62f591579742c"><div class="ttname"><a href="group__image__group.html#afb91869a17fe8a2657a62f591579742c">dwImageProperties::memoryLayout</a></div><div class="ttdeci">dwImageMemoryType memoryLayout</div><div class="ttdoc">Memory layout type.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00402">Image.h:402</a></div></div>
<div class="ttc" id="agroup__image__group_html_ga8e16c1f43bb5f86cd4dc024d97fd3c5c"><div class="ttname"><a href="group__image__group.html#ga8e16c1f43bb5f86cd4dc024d97fd3c5c">dwImage_create</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwImage_create(dwImageHandle_t *const image, dwImageProperties properties, dwContextHandle_t const ctx)</div><div class="ttdoc">Creates and allocates resources for a dwImageHandle_t based on the properties passed as input.</div></div>
<div class="ttc" id="agroup__image__group_html_gga6623e81a22d553d705467c56ba429c34a4ea518b96c3d6af3a0c77779facbb465"><div class="ttname"><a href="group__image__group.html#gga6623e81a22d553d705467c56ba429c34a4ea518b96c3d6af3a0c77779facbb465">DW_IMAGE_CUDA</a></div><div class="ttdeci">@ DW_IMAGE_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00092">Image.h:92</a></div></div>
<div class="ttc" id="agroup__image__group_html_gga6bc1e1a5e55d1d8fa58e0708c57f973ea7de476aa5d96fa5ecf1e7b21a4268e3a"><div class="ttname"><a href="group__image__group.html#gga6bc1e1a5e55d1d8fa58e0708c57f973ea7de476aa5d96fa5ecf1e7b21a4268e3a">DW_IMAGE_MEMORY_TYPE_PITCH</a></div><div class="ttdeci">@ DW_IMAGE_MEMORY_TYPE_PITCH</div><div class="ttdoc">pitch linear memory layout</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00198">Image.h:198</a></div></div>
<div class="ttc" id="agroup__image__group_html_ggab7343d2f61d8450ef8451d4ec73d087ca3bd3c4e72a8ef0652237783a22d1fd29"><div class="ttname"><a href="group__image__group.html#ggab7343d2f61d8450ef8451d4ec73d087ca3bd3c4e72a8ef0652237783a22d1fd29">DW_IMAGE_FORMAT_RGBA_UINT8</a></div><div class="ttdeci">@ DW_IMAGE_FORMAT_RGBA_UINT8</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00144">Image.h:144</a></div></div>
<div class="ttc" id="agroup__image__group_html_structdwImageProperties"><div class="ttname"><a href="group__image__group.html#structdwImageProperties">dwImageProperties</a></div><div class="ttdoc">Defines the properties of the image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00389">Image.h:390</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="image_usecase6_initialize_image_from_file_step2"></a>
Step  3: Get cuda pointer for image memory</h2>
<p >Get the underlying memory using dwImage_getCUDA API to get the cuda pointer for the underlying image </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__image__group.html#structdwImageCUDA">dwImageCUDA</a>* imageCUDA = <span class="keyword">nullptr</span>;</div>
<div class="line">CHECK_AND_HANDLE_ERROR(<a class="code hl_function" href="group__image__group.html#ga9b63aaeb03d9cbda4fec269ec09f53e6">dwImage_getCUDA</a>(&amp;imageCUDA, image));</div>
<div class="ttc" id="agroup__image__group_html_ga9b63aaeb03d9cbda4fec269ec09f53e6"><div class="ttname"><a href="group__image__group.html#ga9b63aaeb03d9cbda4fec269ec09f53e6">dwImage_getCUDA</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwImage_getCUDA(dwImageCUDA **const imageCUDA, dwImageHandle_t const image)</div><div class="ttdoc">Retrieves the dwImageCUDA of a dwImageHandle_t.</div></div>
<div class="ttc" id="agroup__image__group_html_structdwImageCUDA"><div class="ttname"><a href="group__image__group.html#structdwImageCUDA">dwImageCUDA</a></div><div class="ttdoc">Defines a CUDA image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00419">Image.h:420</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="image_usecase6_initialize_image_from_file_step4"></a>
Step  4: Initialize DW image using pixel data</h2>
<p >Using the pixel data obtained above as source, copy it to the cuda pointer using cudaMemcpy2D API as shown below.</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> elemSize   = 0;</div>
<div class="line"><span class="keywordtype">size_t</span> planeCount = 0;</div>
<div class="line">uint32_t planeChannels[<a class="code hl_define" href="group__image__group.html#gaed2f806fa881aaa95e0005d650715ec1">DW_MAX_IMAGE_PLANES</a>];</div>
<div class="line"><a class="code hl_struct" href="MatrixTypes_8h.html#structdwVector2ui">dwVector2ui</a> planeSize[<a class="code hl_define" href="group__image__group.html#gaed2f806fa881aaa95e0005d650715ec1">DW_MAX_IMAGE_PLANES</a>];</div>
<div class="line">CHECK_AND_HANDLE_ERROR(<a class="code hl_function" href="group__image__group.html#gae1542df63c9ba2caab642ea48bd5ce52">dwImage_getDataLayout</a>(&amp;elemSize, &amp;planeCount, planeChannels, planeSize, &amp;imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>));</div>
<div class="line"><span class="keywordtype">size_t</span> srcPitch = planeChannels[0] * elemSize * imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>.<a class="code hl_variable" href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">width</a>;</div>
<div class="line">CHECK_FOR_CUDA_SUCCESS(cudaMemcpy2D(imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a123211cfbe9617888d4487fa7e740914">dptr</a>[0],</div>
<div class="line">                                    imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a526c466fb7c51ad65766d0592dde7013">pitch</a>[0], <span class="comment">// dst pitch</span></div>
<div class="line">                                    pBytes,</div>
<div class="line">                                    srcPitch, <span class="comment">// src pitch</span></div>
<div class="line">                                    srcPitch, <span class="comment">// src width</span></div>
<div class="line">                                    imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>.<a class="code hl_variable" href="group__image__group.html#a792907e1390890033c22c1865a431c8c">height</a>,</div>
<div class="line">                                    cudaMemcpyHostToDevice),</div>
<div class="line">                       <span class="stringliteral">&quot;ImageCreateFromPNG: updateImage: Error: failed to copy to device buffer&quot;</span>);</div>
<div class="ttc" id="aMatrixTypes_8h_html_structdwVector2ui"><div class="ttname"><a href="MatrixTypes_8h.html#structdwVector2ui">dwVector2ui</a></div><div class="ttdoc">Defines a two-element unsigned-integer vector.</div><div class="ttdef"><b>Definition:</b> <a href="MatrixTypes_8h_source.html#l00070">MatrixTypes.h:71</a></div></div>
<div class="ttc" id="agroup__image__group_html_a123211cfbe9617888d4487fa7e740914"><div class="ttname"><a href="group__image__group.html#a123211cfbe9617888d4487fa7e740914">dwImageCUDA::dptr</a></div><div class="ttdeci">void * dptr[DW_MAX_IMAGE_PLANES]</div><div class="ttdoc">Holds the pointer to the image planes.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00426">Image.h:426</a></div></div>
<div class="ttc" id="agroup__image__group_html_a169d7351df4496fe9c6a15c73f20c3d7"><div class="ttname"><a href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">dwImageCUDA::prop</a></div><div class="ttdeci">dwImageProperties prop</div><div class="ttdoc">Defines the properties of the image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00422">Image.h:422</a></div></div>
<div class="ttc" id="agroup__image__group_html_a526c466fb7c51ad65766d0592dde7013"><div class="ttname"><a href="group__image__group.html#a526c466fb7c51ad65766d0592dde7013">dwImageCUDA::pitch</a></div><div class="ttdeci">size_t pitch[DW_MAX_IMAGE_PLANES]</div><div class="ttdoc">Defines the pitch of each plane in bytes.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00424">Image.h:424</a></div></div>
<div class="ttc" id="agroup__image__group_html_gae1542df63c9ba2caab642ea48bd5ce52"><div class="ttname"><a href="group__image__group.html#gae1542df63c9ba2caab642ea48bd5ce52">dwImage_getDataLayout</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwImage_getDataLayout(size_t *const elementSize, size_t *const planeCount, uint32_t planeChannelCount[DW_MAX_IMAGE_PLANES], dwVector2ui planeSize[DW_MAX_IMAGE_PLANES], dwImageProperties const *const prop)</div><div class="ttdoc">Returns the expected data layout of an image given its properties.</div></div>
<div class="ttc" id="agroup__image__group_html_gaed2f806fa881aaa95e0005d650715ec1"><div class="ttname"><a href="group__image__group.html#gaed2f806fa881aaa95e0005d650715ec1">DW_MAX_IMAGE_PLANES</a></div><div class="ttdeci">#define DW_MAX_IMAGE_PLANES</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00083">Image.h:83</a></div></div>
</div><!-- fragment --><p >With above steps, a DW image can be initialized with pixel data obtained from png file.</p>
<dl class="section note"><dt>Note</dt><dd>cudaMemcpy2D should be used as source and destination pitch may differ </dd>
<dd>
Appropriate synchronization can be added when using cuda APIs as required</dd></dl>
<h1><a class="anchor" id="image_usecase6_save_image_to_file"></a>
Saving image contents to file</h1>
<h2><a class="anchor" id="image_usecase6_save_image_to_file_step1"></a>
Step 1: Get image pixels</h2>
<p >The DW image pixel data is accessible using cuda pointer and can be copied using cudaMemcpy2D with cuda pointer as source and an array as destination. The destination shoulkd be large enough to hold pixel data.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code hl_struct" href="group__image__group.html#structdwImageProperties">dwImageProperties</a>&amp; props = imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>;</div>
<div class="line"><span class="keywordtype">size_t</span> elemSize   = 0;</div>
<div class="line"><span class="keywordtype">size_t</span> planeCount = 0;</div>
<div class="line">uint32_t planeChannels[<a class="code hl_define" href="group__image__group.html#gaed2f806fa881aaa95e0005d650715ec1">DW_MAX_IMAGE_PLANES</a>];</div>
<div class="line"><a class="code hl_struct" href="MatrixTypes_8h.html#structdwVector2ui">dwVector2ui</a> planeSize[<a class="code hl_define" href="group__image__group.html#gaed2f806fa881aaa95e0005d650715ec1">DW_MAX_IMAGE_PLANES</a>];</div>
<div class="line">CHECK_AND_HANDLE_ERROR(<a class="code hl_function" href="group__image__group.html#gae1542df63c9ba2caab642ea48bd5ce52">dwImage_getDataLayout</a>(&amp;elemSize, &amp;planeCount, planeChannels, planeSize, &amp;imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>));</div>
<div class="line"><span class="keywordtype">size_t</span> size     = imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>.<a class="code hl_variable" href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">width</a> * imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>.<a class="code hl_variable" href="group__image__group.html#a792907e1390890033c22c1865a431c8c">height</a> * elemSize * planeChannels[0]; <span class="comment">// use only 0th plane for planar image</span></div>
<div class="line"><span class="keywordtype">size_t</span> dstWidth = planeChannels[0] * elemSize * imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a169d7351df4496fe9c6a15c73f20c3d7">prop</a>.<a class="code hl_variable" href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">width</a>;</div>
<div class="line">std::unique_ptr&lt;uint8_t[]&gt; bytes(<span class="keyword">new</span> uint8_t[size]);</div>
<div class="line">CHECK_FOR_CUDA_SUCCESS(cudaMemcpy2D(bytes.get(),</div>
<div class="line">                                    dstWidth,</div>
<div class="line">                                    imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a123211cfbe9617888d4487fa7e740914">dptr</a>[0],</div>
<div class="line">                                    imageCUDA-&gt;<a class="code hl_variable" href="group__image__group.html#a526c466fb7c51ad65766d0592dde7013">pitch</a>[0],</div>
<div class="line">                                    dstWidth,</div>
<div class="line">                                    props.<a class="code hl_variable" href="group__image__group.html#a792907e1390890033c22c1865a431c8c">height</a>,</div>
<div class="line">                                    cudaMemcpyDeviceToHost),</div>
<div class="line">                       <span class="stringliteral">&quot;cudaMemcpy2DA failed&quot;</span>);</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Before reading image using cudaMemcpy2D, application has to ensure that previous writes has finished.</dd></dl>
<h2><a class="anchor" id="image_usecase6_save_image_to_file_step2"></a>
Step 2: Wait for cuda copy to finish</h2>
<p >After cudaMemcpy2D, and before using the destination, application should ensure that copy has finished before using the destination.</p>
<h2><a class="anchor" id="image_usecase6_save_image_to_file_step3"></a>
Step 3: Save the pixel bytes to PNG file</h2>
<p >The pixel data buffer obtained from DW image can now be processed by application as desired or can be saved to an image file. An example to store it as PNG file is shown below.</p>
<div class="fragment"><div class="line">uint32_t res = lodepng_encode_file(destPath.c_str(), bytes.get(), props.<a class="code hl_variable" href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">width</a>, props.<a class="code hl_variable" href="group__image__group.html#a792907e1390890033c22c1865a431c8c">height</a>, LCT_RGBA, elemSize * 8);</div>
<div class="line"><span class="keywordflow">if</span> (res != 0)</div>
<div class="line">{</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot; saveImage: lodepng_encode_file returned error= &quot;</span></div>
<div class="line">                             &lt;&lt; lodepng_error_text(res) &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; res &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
