<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Point Cloud ICP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('pointcloudprocessing_usecase5.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Point Cloud ICP </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>About This Module</h1>
<p >Point cloud ICP module provides an API to align 3D points from a pair of lidar spins via Point-Plane Iterative Closest Points implementation. Its usage is shown in <a class="el" href="dwx_sample_icp.html">ICP (Iterative Closest Points) Sample</a>. This module assumes that only a small translation and rotation exists between the two point clouds (relative to a prior pose provided); Example of a common type of input include lidar sweeps captured less than 2 meters apart from a moving vehicle.</p>
<h1>Terminology in the API</h1>
<p >The two point clouds input to the the ICP module are named <code>Target</code> and <code>Source</code> point clouds respectively. The output of the alignment is the transform that must be applied to Source points so that they align to the target point cloud. As this module uses an iterative approach, a <code>Convergence</code> criteria is used to test if iterations need to stop. <code>Cost</code> of the iteration is a measure of average distance between point and their target planes (please refer to literature on ICP process).</p>
<h1>Principles of implementation.</h1>
<p >In the process of obtaining a temporally-fused point cloud comprising of the sweeps of lidar data captured from a moving lidar unit, one would require to compute the relative pose of the lidar unit between each sweep. This set of poses (described as transforms between successive sweeps of lidar), is such that a measure of mis-alignment is minimum between the two sweeps.</p>
<p >A perfectly well aligned pair of sweeps would be such that the distance between a point on a surface in source sweep lies perfectly flush on the same surface in the target sweep. In other words, sum of distances from a point (in source point cloud) to the plane of it nearest neighbor point (in target cloud) is at its minimum. Iterative Closest Point algorithm finds the transform that that sets this measure to its minimum.</p>
<p >The transform thus generated could be an indicator of the motion of the lidar unit, or could be used to align the point cloud to generated a map of the surrounding, among other uses.</p>
<p >The implemented system this document accompanies, repeatedly moves the source points towards the appropriate plane in the target plane over many iterations. The user can control how many such iterations can take plane and what tolerances of alignments are admissible.</p>
<p >This has been tested with lidar consisting of 64 beams, rotating at 10Hz mounted on vehicle that translates less than approx 2 meters between two spins (nominally, 2Km/h)</p>
<h1>Restrictions on the input data</h1>
<p >ICP Module places the following major restrictions on data input to the module:</p>
<ul>
<li>The number of points may not exceed 32767 points in either source or target clouds.</li>
<li>There is a small rotation/translation relation between the two point clouds, e.g. a translation of no more than 2-meters converges to acceptable results.</li>
<li>Lastly, the point cloud data input via a pointer is arranged in such a way that points in close proximity to one another in 3D space are nearby in the laid out memory.</li>
</ul>
<h1>Iteration Stopping Criteria</h1>
<p >Two criteria control the stopping point of the iteration in this module and consequently the total run time and the accuracy of the results. These criteria are defined in terms of:</p>
<ul>
<li>Rotation (in radians) and translation (in meters) tolerances or</li>
<li>Maximum number of iterations</li>
</ul>
<p >When the difference between results of two iterative steps is smaller than the rotation/translation tolerances, the control returns to the application. The process terminates after a set number of iterations are complete, which is intended to produce a more uniform distribution of run times.</p>
<p >Alternatively, the application can provide a callback for the convergence test. This callback can compare two of the latest transforms and return a value that indicates whether the iterative process should conclude.</p>
<h1>Result Statistics</h1>
<p >ICP Module provides some basic statistics about the last iteration performed. The statistics are a quantitative indicator of the alignment between the point clouds.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    uint16_t actualNumIterations;</div>
<div class="line">    <a class="code hl_typedef" href="group__core__basictypes__group.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a> rmsCost;</div>
<div class="line">    <a class="code hl_typedef" href="group__core__basictypes__group.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a> inlierFraction;</div>
<div class="line">    uint32_t numCorrespondences;</div>
<div class="line">} <a class="code hl_struct" href="group__pointcloudicp__group.html#structdwPointCloudICPResultStats">dwPointCloudICPResultStats</a>;</div>
<div class="ttc" id="agroup__core__basictypes__group_html_ga4611b605e45ab401f02cab15c5e38715"><div class="ttname"><a href="group__core__basictypes__group.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a></div><div class="ttdeci">float float32_t</div><div class="ttdoc">Specifies POD types.</div><div class="ttdef"><b>Definition:</b> <a href="BasicTypes_8h_source.html#l00057">BasicTypes.h:57</a></div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_structdwPointCloudICPResultStats"><div class="ttname"><a href="group__pointcloudicp__group.html#structdwPointCloudICPResultStats">dwPointCloudICPResultStats</a></div><div class="ttdoc">Resulting statistics about the latest ICP run.</div><div class="ttdef"><b>Definition:</b> <a href="PointCloudICP_8h_source.html#l00104">PointCloudICP.h:105</a></div></div>
</div><!-- fragment --><ul>
<li>rmsCost is the main indicator of the alignment, giving the rms of the distance between points in source point clouds to the planes assigned to the corresponding target points.</li>
<li>inlierFraction indicates the fraction (range 0..1) of points that had a point-to-plane error less than or equal to a defined threshold (0.1m).</li>
<li>numCorrespondences is the total number of point-to-plane correspondences used in in the optimization.</li>
<li>actualNumIterations is the actual number of iterations used before terminating.</li>
</ul>
<h1>Workflow</h1>
<p >The module offers a variant of ICP to be used with structured point clouds only, i.e. there is a correlation of the points to their indices. To initialize the module,</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__pointcloudicp__group.html#structdwPointCloudICPParams">dwPointCloudICPParams</a> params{};</div>
<div class="line"><a class="code hl_typedef" href="group__pointcloudicp__group.html#gac70667c1ebae378c9e0bf129bb6eeda3">dwPointCloudICPHandle_t</a> icp;</div>
<div class="line"><a class="code hl_function" href="group__pointcloudicp__group.html#ga429f1575ba80859046af06c69495676d">dwPointCloudICP_getDefaultParams</a>(&amp;params);</div>
<div class="line">params.icpType = <a class="code hl_enumvalue" href="group__pointcloudicp__group.html#gga7a9122a81c94f6f1ed7a3087eeb9e0a1a0cf46f5f2695b73d3b10d3349c91f78f">DW_POINT_CLOUD_ICP_TYPE_DEPTH_MAP</a>;</div>
<div class="line"><a class="code hl_function" href="group__pointcloudicp__group.html#ga3749bcd08a00f5934909849c4622c123">dwPointCloudICP_initialize</a>(&amp;icp, &amp;params, context);</div>
<div class="line"><a class="code hl_function" href="group__pointcloudicp__group.html#gaf2eef3633fa1042ac26b579aad457885">dwPointCloudICP_setCUDAStream</a>(stream, icp);</div>
<div class="ttc" id="agroup__pointcloudicp__group_html_ga3749bcd08a00f5934909849c4622c123"><div class="ttname"><a href="group__pointcloudicp__group.html#ga3749bcd08a00f5934909849c4622c123">dwPointCloudICP_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwPointCloudICP_initialize(dwPointCloudICPHandle_t *obj, const dwPointCloudICPParams *params, dwContextHandle_t ctx)</div><div class="ttdoc">Initializes point cloud icp.</div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_ga429f1575ba80859046af06c69495676d"><div class="ttname"><a href="group__pointcloudicp__group.html#ga429f1575ba80859046af06c69495676d">dwPointCloudICP_getDefaultParams</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwPointCloudICP_getDefaultParams(dwPointCloudICPParams *params)</div><div class="ttdoc">Gets default values of dwPointCloudICPParams object.</div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_gac70667c1ebae378c9e0bf129bb6eeda3"><div class="ttname"><a href="group__pointcloudicp__group.html#gac70667c1ebae378c9e0bf129bb6eeda3">dwPointCloudICPHandle_t</a></div><div class="ttdeci">struct dwPointCloudICPObject * dwPointCloudICPHandle_t</div><div class="ttdef"><b>Definition:</b> <a href="PointCloudICP_8h_source.html#l00056">PointCloudICP.h:56</a></div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_gaf2eef3633fa1042ac26b579aad457885"><div class="ttname"><a href="group__pointcloudicp__group.html#gaf2eef3633fa1042ac26b579aad457885">dwPointCloudICP_setCUDAStream</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwPointCloudICP_setCUDAStream(cudaStream_t const stream, dwPointCloudICPHandle_t obj)</div><div class="ttdoc">Sets CUDA stream of point cloud icp.</div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_gga7a9122a81c94f6f1ed7a3087eeb9e0a1a0cf46f5f2695b73d3b10d3349c91f78f"><div class="ttname"><a href="group__pointcloudicp__group.html#gga7a9122a81c94f6f1ed7a3087eeb9e0a1a0cf46f5f2695b73d3b10d3349c91f78f">DW_POINT_CLOUD_ICP_TYPE_DEPTH_MAP</a></div><div class="ttdeci">@ DW_POINT_CLOUD_ICP_TYPE_DEPTH_MAP</div><div class="ttdoc">Grid based depthmap representation for the lidar point cloud.</div><div class="ttdef"><b>Definition:</b> <a href="PointCloudICP_8h_source.html#l00066">PointCloudICP.h:64</a></div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_structdwPointCloudICPParams"><div class="ttname"><a href="group__pointcloudicp__group.html#structdwPointCloudICPParams">dwPointCloudICPParams</a></div><div class="ttdoc">Defines point cloud icp parameter.</div><div class="ttdef"><b>Definition:</b> <a href="PointCloudICP_8h_source.html#l00071">PointCloudICP.h:72</a></div></div>
</div><!-- fragment --><p >In this particular example, we set <code>params.icpType = <a class="el" href="group__pointcloudicp__group.html#gga7a9122a81c94f6f1ed7a3087eeb9e0a1a0cf46f5f2695b73d3b10d3349c91f78f" title="Grid based depthmap representation for the lidar point cloud.">DW_POINT_CLOUD_ICP_TYPE_DEPTH_MAP</a></code>.</p>
<dl class="section warning"><dt>Warning</dt><dd>Please ensure the input point clouds to the ICP are organized if user selects <code><a class="el" href="group__pointcloudicp__group.html#gga7a9122a81c94f6f1ed7a3087eeb9e0a1a0cf46f5f2695b73d3b10d3349c91f78f" title="Grid based depthmap representation for the lidar point cloud.">DW_POINT_CLOUD_ICP_TYPE_DEPTH_MAP</a></code> as the icp type. See <a class="el" href="pointcloudprocessing_usecase1.html">Point Cloud Memory Management</a> and <a class="el" href="pointcloudprocessing_usecase2.html">Point Cloud Accumulator</a> for point cloud memory allocation and accumulation.</dd></dl>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__pointcloudicp__group.html#gaf65db77d3d6ae371bc026ff46f2d09ca">dwPointCloudICP_bindInput</a>(sourcePointCloud, targetPointCloud, initialSourceToTargetTransformation, icp);</div>
<div class="line"><a class="code hl_function" href="group__pointcloudicp__group.html#ga3c09a90340a5d9b7c910a3a23962bee8">dwPointCloudICP_bindOutput</a>(optimizedSourceToTargetTransformation, icp);</div>
<div class="line"><a class="code hl_function" href="group__pointcloudicp__group.html#gaa42bfc10d0daa3f5384085f2e7ea7c5e">dwPointCloudICP_process</a>(icp);</div>
<div class="ttc" id="agroup__pointcloudicp__group_html_ga3c09a90340a5d9b7c910a3a23962bee8"><div class="ttname"><a href="group__pointcloudicp__group.html#ga3c09a90340a5d9b7c910a3a23962bee8">dwPointCloudICP_bindOutput</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwPointCloudICP_bindOutput(dwTransformation3f *pose, dwPointCloudICPHandle_t obj)</div><div class="ttdoc">Binds an output buffer to the resulting transformation between a source and a target point clouds.</div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_gaa42bfc10d0daa3f5384085f2e7ea7c5e"><div class="ttname"><a href="group__pointcloudicp__group.html#gaa42bfc10d0daa3f5384085f2e7ea7c5e">dwPointCloudICP_process</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwPointCloudICP_process(dwPointCloudICPHandle_t obj)</div><div class="ttdoc">Estimates the transformation aligns two PointClouds.</div></div>
<div class="ttc" id="agroup__pointcloudicp__group_html_gaf65db77d3d6ae371bc026ff46f2d09ca"><div class="ttname"><a href="group__pointcloudicp__group.html#gaf65db77d3d6ae371bc026ff46f2d09ca">dwPointCloudICP_bindInput</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwPointCloudICP_bindInput(const dwPointCloud *sourcePCD, const dwPointCloud *targetPCD, const dwTransformation3f *sourceToTarget, dwPointCloudICPHandle_t obj)</div><div class="ttdoc">Binds input buffers of a source and a target point clouds as well as a buffer with an initial transfo...</div></div>
</div><!-- fragment --><p >API allows user to provide initial guess on the transformation between the source and target point clouds. If <code>nullptr</code> is provided, ICP will use identity transformation as initial guess.</p>
<p >To release the module, </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__pointcloudicp__group.html#ga6158cc60ed4f3467191224ea7712d246">dwPointCloudICP_release</a>(icp);</div>
<div class="ttc" id="agroup__pointcloudicp__group_html_ga6158cc60ed4f3467191224ea7712d246"><div class="ttname"><a href="group__pointcloudicp__group.html#ga6158cc60ed4f3467191224ea7712d246">dwPointCloudICP_release</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwPointCloudICP_release(dwPointCloudICPHandle_t obj)</div><div class="ttdoc">Releases a handle of a point cloud icp created using 'dwPointCloudICP_initialize'.</div></div>
</div><!-- fragment --><p >For more details see <a class="el" href="dwx_pointcloudprocessing_sample.html">Point Cloud Processing Sample</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
