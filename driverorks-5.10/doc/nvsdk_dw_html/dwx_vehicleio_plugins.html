<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: VehicleIO Plugins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dwx_vehicleio_plugins.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">VehicleIO Plugins </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#vehicleIO_plugin_overview">VehicleIO Plugins Overview</a></li>
<li class="level1"><a href="#vehicleIO_plugin_implementation">Implementing Custom VehicleIO Plugin</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="vehicleIO_plugin_overview"></a>
VehicleIO Plugins Overview</h1>
<p >The VehicleIO Plugin back-end enables writing fully customized drive-by-wire abstraction that will be represented as a <a class="el" href="vehicleio_mainsection.html">VehicleIO</a> interface for the rest of the software stack.</p>
<h1><a class="anchor" id="vehicleIO_plugin_implementation"></a>
Implementing Custom VehicleIO Plugin</h1>
<p >A VehicleIO plugin in DriveWorks requires implementing a set of pre-defined functions. The declarations of these functions are located in <code><a class="el" href="VehicleIODriver_8h.html" title="NVIDIA DriveWorks API: VehicleIO Driver">dw/control/vehicleio/plugins/VehicleIODriver.h</a></code>.</p>
<p >In this tutorial, we are going to implement a simple drive-by-wire system that is responsible for steering wheel angle. See <a class="el" href="dwx_vehicleio_plugin_sample.html">VehicleIO Plugin Sample</a> for the corresponding sample code.</p>
<h1>Initialization</h1>
<p >In essence, our plugin is a dynamically loaded shared library, and the core <a class="el" href="vehicleio_mainsection.html">VehicleIO</a> module will first call <code><a class="el" href="group__vehicleiodriver__group.html#ga4c5a69fd73ffbdef69b0fa2a281ee1fa" title="Initializes the VehicleIO Driver.">_dwVehicleIODriver_initialize()</a></code> function of this library, which should prepare all objects and state that is needed for the plugin to function:</p>
<div class="fragment"><div class="line"><a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> <a class="code hl_function" href="group__vehicleiodriver__group.html#ga4c5a69fd73ffbdef69b0fa2a281ee1fa">_dwVehicleIODriver_initialize</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> status;</div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> result = DW_SUCCESS;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="group__core__context__group.html#structdwContextParameters">dwContextParameters</a> sdkParams = {};</div>
<div class="line">    <a class="code hl_function" href="group__core__context__group.html#ga01e8476c6a7d6155335bd4da7775a3da">dwInitialize</a>(&amp;gSdk, <a class="code hl_define" href="VersionCurrent_8h.html#a45464d71bb6003b7e36f39f2be67056c">DW_VERSION</a>, &amp;sdkParams);</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#ga4f8f6b74754d7d5ddb0b0e66f56c0883">dwCANInterpreter_buildFromDBC</a>(&amp;gIntp, (<span class="stringliteral">&quot;AutonomousVehicleCANSignals.dbc&quot;</span>), gSdk);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;cannot create DBC-based CAN message interpreter&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="ttc" id="aVersionCurrent_8h_html_a45464d71bb6003b7e36f39f2be67056c"><div class="ttname"><a href="VersionCurrent_8h.html#a45464d71bb6003b7e36f39f2be67056c">DW_VERSION</a></div><div class="ttdeci">#define DW_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="VersionCurrent_8h_source.html#l00044">VersionCurrent.h:44</a></div></div>
<div class="ttc" id="agroup__core__context__group_html_ga01e8476c6a7d6155335bd4da7775a3da"><div class="ttname"><a href="group__core__context__group.html#ga01e8476c6a7d6155335bd4da7775a3da">dwInitialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwInitialize(dwContextHandle_t *const context, dwVersion const headerVersion, dwContextParameters const *const params)</div><div class="ttdoc">Creates and initializes an SDK context.</div></div>
<div class="ttc" id="agroup__core__context__group_html_structdwContextParameters"><div class="ttname"><a href="group__core__context__group.html#structdwContextParameters">dwContextParameters</a></div><div class="ttdoc">A set of parameters that is passed to the SDK to create the context.</div><div class="ttdef"><b>Definition:</b> <a href="Context_8h_source.html#l00092">Context.h:93</a></div></div>
<div class="ttc" id="agroup__core__status__group_html_ga01e41060986cf4c0d618a8923846619b"><div class="ttname"><a href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a></div><div class="ttdeci">dwStatus</div><div class="ttdoc">Status definition.</div><div class="ttdef"><b>Definition:</b> <a href="Status_8h_source.html#l00173">Status.h:173</a></div></div>
<div class="ttc" id="agroup__interpreter__group_html_ga4f8f6b74754d7d5ddb0b0e66f56c0883"><div class="ttname"><a href="group__interpreter__group.html#ga4f8f6b74754d7d5ddb0b0e66f56c0883">dwCANInterpreter_buildFromDBC</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_buildFromDBC(dwCANInterpreterHandle_t *interpreter, const char8_t *inputDBC, dwContextHandle_t ctx)</div><div class="ttdoc">Creates a CAN data interpreter based on DBC file format.</div></div>
<div class="ttc" id="agroup__vehicleiodriver__group_html_ga4c5a69fd73ffbdef69b0fa2a281ee1fa"><div class="ttname"><a href="group__vehicleiodriver__group.html#ga4c5a69fd73ffbdef69b0fa2a281ee1fa">_dwVehicleIODriver_initialize</a></div><div class="ttdeci">dwStatus _dwVehicleIODriver_initialize()</div><div class="ttdoc">Initializes the VehicleIO Driver.</div></div>
</div><!-- fragment --><p >Above, <code><a class="el" href="group__interpreter__group.html#ga4f8f6b74754d7d5ddb0b0e66f56c0883" title="Creates a CAN data interpreter based on DBC file format.">dwCANInterpreter_buildFromDBC()</a></code> function initializes an interpreter object that will be useful to work with our DBC file. See <a class="el" href="dwx_canbus_message_sample.html">CAN Message Interpreter Sample</a> for more information about CAN interpreter usage.</p>
<p >When using the plugin with, for example, <a class="el" href="dwx_vehicleio_sample.html">VehicleIO Sample</a>, in order for VehicleIO core to load the plugin, Rig file should specify "custom" VehicleIO node:</p>
<div class="fragment"><div class="line">{   </div>
<div class="line">    &quot;rig&quot;: {</div>
<div class="line">        &quot;vehicleio&quot;: [</div>
<div class="line">            {   </div>
<div class="line">                &quot;type&quot;: &quot;custom&quot;,</div>
<div class="line">                &quot;parent-sensor&quot;: &quot;can:vehicle:custom&quot;,</div>
<div class="line">                &quot;custom-lib&quot;: &quot;../../../bin/libsample_vehicleio_plugin.so&quot;</div>
<div class="line">            }</div>
<div class="line">        ],</div>
<div class="line">        &quot;sensors&quot;: [</div>
<div class="line">            {   </div>
<div class="line">                &quot;name&quot;: &quot;can:vehicle:custom&quot;,</div>
<div class="line">                &quot;parameter&quot;: &quot;file=can-vio-generic.bin&quot;,</div>
<div class="line">                &quot;protocol&quot;: &quot;can.virtual&quot;,</div>
<div class="line">                &quot;properties&quot;: null,</div>
<div class="line">                &quot;nominalSensor2Rig&quot;: { &quot;quaternion&quot;: [ 0.0, 0.0, 0.0, 1.0 ], &quot;t&quot;: [ 0.0, 0.0, 0.0 ] },</div>
<div class="line">                &quot;sensor2Rig&quot;: { &quot;quaternion&quot;: [ 0.0, 0.0, 0.0, 1.0 ], &quot;t&quot;: [ 0.0, 0.0, 0.0 ] }</div>
<div class="line">            }</div>
<div class="line">        ]</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >Full example of Rig file is available in <code>data/samples/vehicleio/rig-plugin.json</code>, and exact commands how to run the VehicleIO sample with the plugin is available at <a class="el" href="dwx_vehicleio_plugin_sample.html">VehicleIO Plugin Sample</a>.</p>
<h1>Releasing</h1>
<p >When plugin is no longer needed, VehicleIO core will call <code><a class="el" href="group__vehicleiodriver__group.html#ga7e116e6a620b7389ccf43ef8f9ce2f43" title="Releases the VehicleIO Driver.">_dwVehicleIODriver_release()</a></code> method, which is an opportunity for the module to cleanup any created objects and state:</p>
<div class="fragment"><div class="line"><a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> <a class="code hl_function" href="group__vehicleiodriver__group.html#ga7e116e6a620b7389ccf43ef8f9ce2f43">_dwVehicleIODriver_release</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="group__interpreter__group.html#gad085933757eb23b89253b1927db12aa9">dwCANInterpreter_release</a>(gIntp);</div>
<div class="line">    <a class="code hl_function" href="group__core__context__group.html#ga1355900f5b56536efe4ece156c444ecb">dwRelease</a>(gSdk);</div>
<div class="line">    <span class="keywordflow">return</span> DW_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__core__context__group_html_ga1355900f5b56536efe4ece156c444ecb"><div class="ttname"><a href="group__core__context__group.html#ga1355900f5b56536efe4ece156c444ecb">dwRelease</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwRelease(dwContextHandle_t const context)</div><div class="ttdoc">Releases the context.</div></div>
<div class="ttc" id="agroup__interpreter__group_html_gad085933757eb23b89253b1927db12aa9"><div class="ttname"><a href="group__interpreter__group.html#gad085933757eb23b89253b1927db12aa9">dwCANInterpreter_release</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_release(dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Closes previously opened interpreter.</div></div>
<div class="ttc" id="agroup__vehicleiodriver__group_html_ga7e116e6a620b7389ccf43ef8f9ce2f43"><div class="ttname"><a href="group__vehicleiodriver__group.html#ga7e116e6a620b7389ccf43ef8f9ce2f43">_dwVehicleIODriver_release</a></div><div class="ttdeci">dwStatus _dwVehicleIODriver_release()</div><div class="ttdoc">Releases the VehicleIO Driver.</div></div>
</div><!-- fragment --><h1>CAN messages consumption</h1>
<p >CAN messages represent the input to the module, which plugin must parse and update its state, if needed. VehicleIO core will call plugin's <code><a class="el" href="group__vehicleiodriver__group.html#ga1c08892ed9b51cfdda8f12c7078178fa" title="Consume a received CAN message and update the vehicle state.">_dwVehicleIODriver_consume()</a></code> function when there is a new message to consume:</p>
<div class="fragment"><div class="line"><a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> <a class="code hl_function" href="group__vehicleiodriver__group.html#ga1c08892ed9b51cfdda8f12c7078178fa">_dwVehicleIODriver_consume</a>(<span class="keyword">const</span> <a class="code hl_struct" href="group__can__group.html#structdwCANMessage">dwCANMessage</a>* msg, <a class="code hl_struct" href="group__VehicleIO__actuators__group.html#structdwVehicleIOState">dwVehicleIOState</a>* state)</div>
<div class="line">{   </div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> status;</div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> result = DW_SUCCESS;</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#ga619370487ca53b05805c22bcf701c91a">dwCANInterpreter_consume</a>(msg, gIntp);</div>
<div class="line">    checkError(result ,status, <span class="stringliteral">&quot;consume message failed&quot;</span>);</div>
<div class="line">    parseSteeringReport(state);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_structdwVehicleIOState"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#structdwVehicleIOState">dwVehicleIOState</a></div><div class="ttdoc">The vehicle IO state data.</div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00687">VehicleIOLegacyStructures.h:688</a></div></div>
<div class="ttc" id="agroup__can__group_html_structdwCANMessage"><div class="ttname"><a href="group__can__group.html#structdwCANMessage">dwCANMessage</a></div><div class="ttdoc">Holds a CAN package.</div><div class="ttdef"><b>Definition:</b> <a href="CAN_8h_source.html#l00112">CAN.h:113</a></div></div>
<div class="ttc" id="agroup__interpreter__group_html_ga619370487ca53b05805c22bcf701c91a"><div class="ttname"><a href="group__interpreter__group.html#ga619370487ca53b05805c22bcf701c91a">dwCANInterpreter_consume</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_consume(const dwCANMessage *msg, dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Pushes a new message to the interpreter.</div></div>
<div class="ttc" id="agroup__vehicleiodriver__group_html_ga1c08892ed9b51cfdda8f12c7078178fa"><div class="ttname"><a href="group__vehicleiodriver__group.html#ga1c08892ed9b51cfdda8f12c7078178fa">_dwVehicleIODriver_consume</a></div><div class="ttdeci">dwStatus _dwVehicleIODriver_consume(const dwCANMessage *msg, dwVehicleIOState *state)</div><div class="ttdoc">Consume a received CAN message and update the vehicle state.</div></div>
</div><!-- fragment --><p >In the example above, we simply parse current steering angle report using our CAN/DBC interpreter:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> parseSteeringReport(<a class="code hl_struct" href="group__VehicleIO__actuators__group.html#structdwVehicleIOState">dwVehicleIOState</a>* state)</div>
<div class="line">{   </div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> status;</div>
<div class="line">    uint32_t num;</div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#gabd1634af490894504372febcf71d0eaf">dwCANInterpreter_getNumberSignals</a>(&amp;num, gIntp);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (status == DW_SUCCESS &amp;&amp; num &gt; 0)</div>
<div class="line">    {   </div>
<div class="line">        <a class="code hl_typedef" href="group__core__basictypes__group.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a> value    = 0;</div>
<div class="line">        <a class="code hl_typedef" href="group__core__basictypes__group.html#gac4840df46df4be80c7f427057740af65">dwTime_t</a> timestamp = 0;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* name;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; num; ++i)</div>
<div class="line">        {   </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_function" href="group__interpreter__group.html#ga250c05b1bb2dca4a6290bdcf51944614">dwCANInterpreter_getSignalName</a>(&amp;name, i, gIntp) == DW_SUCCESS)</div>
<div class="line">            {   </div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code hl_function" href="group__interpreter__group.html#gadad6b9858e6f08cc14f4ac9d2f880278">dwCANInterpreter_getf32</a>(&amp;value, &amp;timestamp, i, gIntp) == DW_SUCCESS)</div>
<div class="line">                {   </div>
<div class="line">                    <span class="keywordflow">if</span> (0 == strcmp(name, GENERIC_ID_STEERING_WHEEL_ANGLE_REPORT))</div>
<div class="line">                        state-&gt;<a class="code hl_variable" href="group__VehicleIO__actuators__group.html#ae354926462b16fcdf1b1c1592b7fc8d5">steeringWheelAngle</a> = value;</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(name, GENERIC_ID_STEERING_WHEEL_TORQUE_REPORT))</div>
<div class="line">                        state-&gt;<a class="code hl_variable" href="group__VehicleIO__actuators__group.html#a5de80cb5a72b6cb9ffed1c782abc05ee">steeringWheelTorque</a> = value;</div>
<div class="line">                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(name, GENERIC_ID_STEERING_WHEEL_SPEED_REPORT))</div>
<div class="line">                        state-&gt;<a class="code hl_variable" href="group__VehicleIO__actuators__group.html#ab379ea1e2f15ec5edaeae3f29c5570dc">speed</a> = value;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_a5de80cb5a72b6cb9ffed1c782abc05ee"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#a5de80cb5a72b6cb9ffed1c782abc05ee">dwVehicleIOState::steeringWheelTorque</a></div><div class="ttdeci">float32_t steeringWheelTorque</div><div class="ttdoc">Steering wheel torque (0 to 10.0 +- 0.01 Nm)</div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00699">VehicleIOLegacyStructures.h:699</a></div></div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_ab379ea1e2f15ec5edaeae3f29c5570dc"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#ab379ea1e2f15ec5edaeae3f29c5570dc">dwVehicleIOState::speed</a></div><div class="ttdeci">float32_t speed</div><div class="ttdoc">Signed norm of velocity vector.</div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00690">VehicleIOLegacyStructures.h:690</a></div></div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_ae354926462b16fcdf1b1c1592b7fc8d5"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#ae354926462b16fcdf1b1c1592b7fc8d5">dwVehicleIOState::steeringWheelAngle</a></div><div class="ttdeci">float32_t steeringWheelAngle</div><div class="ttdoc">Steering wheel angle (-10.0 to 10.0 +- 0.01rad)</div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00697">VehicleIOLegacyStructures.h:697</a></div></div>
<div class="ttc" id="agroup__core__basictypes__group_html_ga4611b605e45ab401f02cab15c5e38715"><div class="ttname"><a href="group__core__basictypes__group.html#ga4611b605e45ab401f02cab15c5e38715">float32_t</a></div><div class="ttdeci">float float32_t</div><div class="ttdoc">Specifies POD types.</div><div class="ttdef"><b>Definition:</b> <a href="BasicTypes_8h_source.html#l00057">BasicTypes.h:57</a></div></div>
<div class="ttc" id="agroup__core__basictypes__group_html_gac4840df46df4be80c7f427057740af65"><div class="ttname"><a href="group__core__basictypes__group.html#gac4840df46df4be80c7f427057740af65">dwTime_t</a></div><div class="ttdeci">int64_t dwTime_t</div><div class="ttdoc">Specifies a timestamp unit, in microseconds.</div><div class="ttdef"><b>Definition:</b> <a href="BasicTypes_8h_source.html#l00063">BasicTypes.h:63</a></div></div>
<div class="ttc" id="agroup__interpreter__group_html_ga250c05b1bb2dca4a6290bdcf51944614"><div class="ttname"><a href="group__interpreter__group.html#ga250c05b1bb2dca4a6290bdcf51944614">dwCANInterpreter_getSignalName</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_getSignalName(const char8_t **name, uint32_t idx, dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Gets the name of a signal available for consumption by the application as a string.</div></div>
<div class="ttc" id="agroup__interpreter__group_html_gabd1634af490894504372febcf71d0eaf"><div class="ttname"><a href="group__interpreter__group.html#gabd1634af490894504372febcf71d0eaf">dwCANInterpreter_getNumberSignals</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_getNumberSignals(uint32_t *num, dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Gets the number of signals decoded and available for consumption by the application side.</div></div>
<div class="ttc" id="agroup__interpreter__group_html_gadad6b9858e6f08cc14f4ac9d2f880278"><div class="ttname"><a href="group__interpreter__group.html#gadad6b9858e6f08cc14f4ac9d2f880278">dwCANInterpreter_getf32</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_getf32(float32_t *value, dwTime_t *timestamp_us, uint32_t idx, dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Gets a 'float32_t' value from the available values.</div></div>
</div><!-- fragment --><h1>CAN messages generation</h1>
<p >CAN messages are also the output of the module, thus when VehicleIO is requested to send a command, the core module will relay the request to the plugin, issuing two calls: <code><a class="el" href="group__vehicleiodriver__group.html#ga56c56c8391dbd8cf76ffdee479a02fbc" title="Send a vehicle command to the given CAN sensor.">_dwVehicleIODriver_sendCommand()</a></code> and <code><a class="el" href="group__vehicleiodriver__group.html#gaa17e46bb1dfba62a3af04af4dcef5e26" title="Send misc vehicle command to the given CAN sensor.">_dwVehicleIODriver_sendMiscCommand()</a></code>. Each of the function should encode command arguments into CAN messages and send via a provided sensor handle:</p>
<div class="fragment"><div class="line"><a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> <a class="code hl_function" href="group__vehicleiodriver__group.html#ga56c56c8391dbd8cf76ffdee479a02fbc">_dwVehicleIODriver_sendCommand</a>(<span class="keyword">const</span> <a class="code hl_struct" href="group__VehicleIO__actuators__group.html#structdwVehicleIOCommand">dwVehicleIOCommand</a>* cmd,</div>
<div class="line">                       <a class="code hl_typedef" href="group__sensors__common__group.html#gadc6a1730acf17825ffa9620434b5959a">dwSensorHandle_t</a> sensor)</div>
<div class="line">{   </div>
<div class="line">    <a class="code hl_struct" href="group__can__group.html#structdwCANMessage">dwCANMessage</a> msgCAN{};</div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> status;</div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> result = DW_SUCCESS;</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#ga7c48ed184a8f76dce9e6f37d4a9f8834">dwCANInterpreter_createMessageFromName</a>(&amp;msgCAN, GENERIC_MSG_STEERING_CMD, gIntp);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;create steering message failed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    status = encodeSteering(msgCAN, cmd);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;encode steering failed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__can__group.html#gad746719abb9bf690fec919869c5e93f4">dwSensorCAN_sendMessage</a>(&amp;msgCAN, 1000000, sensor);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;send steering failed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> <a class="code hl_function" href="group__vehicleiodriver__group.html#gaa17e46bb1dfba62a3af04af4dcef5e26">_dwVehicleIODriver_sendMiscCommand</a>(<span class="keyword">const</span> <a class="code hl_struct" href="group__VehicleIO__actuators__group.html#structdwVehicleIOMiscCommand">dwVehicleIOMiscCommand</a>*,</div>
<div class="line">                       <a class="code hl_typedef" href="group__sensors__common__group.html#gadc6a1730acf17825ffa9620434b5959a">dwSensorHandle_t</a>)</div>
<div class="line">{   </div>
<div class="line">    <span class="keywordflow">return</span> DW_NOT_IMPLEMENTED;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_structdwVehicleIOCommand"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#structdwVehicleIOCommand">dwVehicleIOCommand</a></div><div class="ttdoc">The command data.</div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00426">VehicleIOLegacyStructures.h:427</a></div></div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_structdwVehicleIOMiscCommand"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#structdwVehicleIOMiscCommand">dwVehicleIOMiscCommand</a></div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00557">VehicleIOLegacyStructures.h:558</a></div></div>
<div class="ttc" id="agroup__can__group_html_gad746719abb9bf690fec919869c5e93f4"><div class="ttname"><a href="group__can__group.html#gad746719abb9bf690fec919869c5e93f4">dwSensorCAN_sendMessage</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensorCAN_sendMessage(const dwCANMessage *const msg, dwTime_t const timeoutUs, dwSensorHandle_t const sensor)</div><div class="ttdoc">Sends a message over the CAN bus within a specified timeout.</div></div>
<div class="ttc" id="agroup__interpreter__group_html_ga7c48ed184a8f76dce9e6f37d4a9f8834"><div class="ttname"><a href="group__interpreter__group.html#ga7c48ed184a8f76dce9e6f37d4a9f8834">dwCANInterpreter_createMessageFromName</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_createMessageFromName(dwCANMessage *msg, const char8_t *msgName, dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Initializes an empty can message an interpreter can encoded signals into.</div></div>
<div class="ttc" id="agroup__sensors__common__group_html_gadc6a1730acf17825ffa9620434b5959a"><div class="ttname"><a href="group__sensors__common__group.html#gadc6a1730acf17825ffa9620434b5959a">dwSensorHandle_t</a></div><div class="ttdeci">struct dwSensorObject * dwSensorHandle_t</div><div class="ttdoc">Handle representing a sensor.</div><div class="ttdef"><b>Definition:</b> <a href="Sensors_8h_source.html#l00086">Sensors.h:86</a></div></div>
<div class="ttc" id="agroup__vehicleiodriver__group_html_ga56c56c8391dbd8cf76ffdee479a02fbc"><div class="ttname"><a href="group__vehicleiodriver__group.html#ga56c56c8391dbd8cf76ffdee479a02fbc">_dwVehicleIODriver_sendCommand</a></div><div class="ttdeci">dwStatus _dwVehicleIODriver_sendCommand(const dwVehicleIOCommand *cmd, dwSensorHandle_t sensor)</div><div class="ttdoc">Send a vehicle command to the given CAN sensor.</div></div>
<div class="ttc" id="agroup__vehicleiodriver__group_html_gaa17e46bb1dfba62a3af04af4dcef5e26"><div class="ttname"><a href="group__vehicleiodriver__group.html#gaa17e46bb1dfba62a3af04af4dcef5e26">_dwVehicleIODriver_sendMiscCommand</a></div><div class="ttdeci">dwStatus _dwVehicleIODriver_sendMiscCommand(const dwVehicleIOMiscCommand *cmd, dwSensorHandle_t sensor)</div><div class="ttdoc">Send misc vehicle command to the given CAN sensor.</div></div>
</div><!-- fragment --><p >If certain type of commands are not relevant, the plugin is permitted to return <code>DW_NOT_IMPLEMENTED</code> status, as was shown in <code><a class="el" href="group__vehicleiodriver__group.html#gaa17e46bb1dfba62a3af04af4dcef5e26" title="Send misc vehicle command to the given CAN sensor.">_dwVehicleIODriver_sendMiscCommand()</a></code> above.</p>
<p >And as in previous section, we use CAN interpreter to encode commands into CAN messages:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> encodeSteering(<a class="code hl_struct" href="group__can__group.html#structdwCANMessage">dwCANMessage</a>&amp; msgCAN, <span class="keyword">const</span> <a class="code hl_struct" href="group__VehicleIO__actuators__group.html#structdwVehicleIOCommand">dwVehicleIOCommand</a>* cmd)</div>
<div class="line">{   </div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> status;</div>
<div class="line">    <a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> result = DW_SUCCESS;</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#ga22348f6065b56930bb3e3667441347d2">dwCANInterpreter_encodef32</a>(cmd-&gt;<a class="code hl_variable" href="group__VehicleIO__actuators__group.html#ac1831c9542aff3253bfef807e181aa10">steeringWheelAngle</a>,</div>
<div class="line">                                        GENERIC_ID_STEERING_WHEEL_ANGLE_COMMAND,</div>
<div class="line">                                        &amp;msgCAN, gIntp);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;encode steering angle failed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#ga06ad3fa3d70f52220a05bf4f910daea4">dwCANInterpreter_encodei32</a>(cmd-&gt;steeringValid,</div>
<div class="line">                                        GENERIC_ID_STEERING_WHEEL_ANGLE_COMMAND_VALID,</div>
<div class="line">                                        &amp;msgCAN, gIntp);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;encode steering valid failed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#ga22348f6065b56930bb3e3667441347d2">dwCANInterpreter_encodef32</a>(cmd-&gt;steeringSpeed,</div>
<div class="line">                                        GENERIC_ID_STEERING_WHEEL_STEER_SPEED,</div>
<div class="line">                                        &amp;msgCAN, gIntp);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;encode steering speed failed&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="group__interpreter__group.html#ga06ad3fa3d70f52220a05bf4f910daea4">dwCANInterpreter_encodei32</a>(cmd-&gt;<a class="code hl_variable" href="group__VehicleIO__actuators__group.html#ac4f0afff4ba4548ceb895d2cf1f3c6ae">clearFaults</a> ? <span class="keyword">true</span> : <span class="keyword">false</span>,</div>
<div class="line">                                        GENERIC_ID_STEERING_WHEEL_STEER_CLEAR_FAULT,</div>
<div class="line">                                        &amp;msgCAN, gIntp);</div>
<div class="line">    checkError(result, status, <span class="stringliteral">&quot;encode steering clear fault failed&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_ac1831c9542aff3253bfef807e181aa10"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#ac1831c9542aff3253bfef807e181aa10">dwVehicleIOCommand::steeringWheelAngle</a></div><div class="ttdeci">float32_t steeringWheelAngle</div><div class="ttdoc">Desired steering wheel angle (rad)</div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00431">VehicleIOLegacyStructures.h:431</a></div></div>
<div class="ttc" id="agroup__VehicleIO__actuators__group_html_ac4f0afff4ba4548ceb895d2cf1f3c6ae"><div class="ttname"><a href="group__VehicleIO__actuators__group.html#ac4f0afff4ba4548ceb895d2cf1f3c6ae">dwVehicleIOCommand::clearFaults</a></div><div class="ttdeci">bool clearFaults</div><div class="ttdoc">Setting &gt; 0 clears any canbus faults/errors.</div><div class="ttdef"><b>Definition:</b> <a href="VehicleIOLegacyStructures_8h_source.html#l00464">VehicleIOLegacyStructures.h:464</a></div></div>
<div class="ttc" id="agroup__interpreter__group_html_ga06ad3fa3d70f52220a05bf4f910daea4"><div class="ttname"><a href="group__interpreter__group.html#ga06ad3fa3d70f52220a05bf4f910daea4">dwCANInterpreter_encodei32</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_encodei32(int32_t value, const char8_t *signal, dwCANMessage *msg, dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Same as dwCANInterpreter_encodef32, but for int32 types.</div></div>
<div class="ttc" id="agroup__interpreter__group_html_ga22348f6065b56930bb3e3667441347d2"><div class="ttname"><a href="group__interpreter__group.html#ga22348f6065b56930bb3e3667441347d2">dwCANInterpreter_encodef32</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCANInterpreter_encodef32(float32_t value, const char8_t *signal, dwCANMessage *msg, dwCANInterpreterHandle_t interpreter)</div><div class="ttdoc">Encodes a value for a signal into a given message.</div></div>
</div><!-- fragment --><h1>Building plugin as a dynamic library</h1>
<p >The plugin code must be compiled into a dynamic library.</p>
<p >Firstly, we should create a folder under <code>samples</code> called <code>vehicleio_plugin</code> and create a <code>CMakeLists.txt</code> under this folder:</p>
<div class="fragment"><div class="line">project(sample_vehicleio_plugin C CXX)</div>
<div class="line"> </div>
<div class="line">set(SOURCES</div>
<div class="line">    driverConf.hpp</div>
<div class="line">    driver.cpp</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">set(LIBRARIES</div>
<div class="line">    samples_framework</div>
<div class="line">    ${Driveworks_LIBRARIES}</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">add_library(${PROJECT_NAME} SHARED ${SOURCES})</div>
<div class="line">target_link_libraries(${PROJECT_NAME} PRIVATE ${LIBRARIES})</div>
<div class="line">set_property(TARGET ${PROJECT_NAME} PROPERTY FOLDER &quot;Samples&quot;)</div>
<div class="line"> </div>
<div class="line">get_property(TARGET_PACKAGE GLOBAL PROPERTY TARGET_PACKAGE)</div>
<div class="line">install(TARGETS ${PROJECT_NAME}</div>
<div class="line">    COMPONENT dw-samples-${TARGET_PACKAGE} # targeted package (dw / dav / ..)</div>
<div class="line">    DESTINATION ${SDK_SAMPLE_DESTINATION}</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">sdk_add_sample(${PROJECT_NAME})</div>
</div><!-- fragment --><p >Run <code>cmake</code> and the preferred build system to compile the library. This will generate a <code>libsample_vehicleio_plugin.so</code>.</p>
<p >See <a class="el" href="dwx_vehicleio_plugin_sample.html">VehicleIO Plugin Sample</a> for more details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
