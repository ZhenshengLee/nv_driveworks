<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Lidar Self-Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('calibration_usecase_lidar.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Lidar Self-Calibration </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Lidar Calibration - Operating Principle</h1>
<p >Lidar calibration estimates the current sensor orientation (roll, pitch, yaw) and height with respect to the vehicle coordinate frame. Roll, pitch and height are estimated via fitting a ground plane near the vehicle. Yaw and pitch are estimated via aligning the vehicle egomotion with the Lidar sensor motion in the same time interval. Calibration will stop once the vehicle drives in a speed lower than 5 km/h. It will resume once the vehicle drives faster than that speed limit. Current estimation targets at multi-beam 360 degree rotational Lidar sensors, i.e. Velodyne-HDL32E and Velodyne-HDL64E.</p>
<h2>Lidar Roll/Pitch/Yaw/Height</h2>
<p >Current roll/pitch/height estimation is not suitable for Lidar sensor with low density and narrow horizontal field-of-view, i.e. Velodyne-VLP16 and IBEO-LUX4. The estimation inputs a full Lidar sweep and expects sufficient cloud of points in the vehicle vicinity. Such Region-Of-Interest (rectangular ROI) is defined by the vehicle physical specifications and nominal sensor calibration. In the ROI, the method selects 3D Lidar points whose heights are within a certain threshold for ground plane fitting and optimization. The estimated ground plane normal vector is used to compute the roll and pitch corrections with respect to the nominal sensor coordinate frame. The ground plane's distance to the sensor coordinate origin defines the actual height.</p>
<p >Yaw can not be determined by ground plane fitting. It requires extra information such as vehicle presents circular trajectory while driving. Hand-eye optimization aligns vehicle relative pose with Lidar point cloud relative poses between two timestamps. The optimization outputs yaw/pitch angles. Those estimates (roll/pitch/height and yaw/pitch) are inserted into robust estimation histograms over time. After the estimates are accepted, their modes define the best estimations. Pitch is considered to be accepted only if the two pitch estimates (hand-eye and ground-plane-based) agree with each other within small threshold (see histograms below).</p>
<div class="image">
<img src="self_calib_lidar.png" alt=""/>
<div class="caption">
Roll/Pitch/Yaw/Height estimation histograms (bottom), collected over a period of time</div></div>
    <h1>Requirements</h1>
<h2>Initialization Requirements</h2>
<ul>
<li>Nominal values on Lidar calibration<ul>
<li>Orientation(roll/pitch/yaw): less than 10 degree error</li>
<li>Position(x/y/z): x and y are not used for now, z is less than 10 cm error</li>
<li>Vehicle physical dimenstions: wheel base, vehicle width and length</li>
</ul>
</li>
</ul>
<h2>Runtime Calibration Dependencies</h2>
<ul>
<li>If using IMU-based egomotion in the pose-based API, then egomotion needs to be based on accurate IMU calibration</li>
</ul>
<h2>Input Requirements</h2>
<ul>
<li>Assumption: Vehicle performs the aforementioned maneuvers until calibration convergence.</li>
<li>Vehicle egomotion: requirements can be found in the <a class="el" href="egomotion_mainsection.html">Egomotion</a> module</li>
<li>Sensors: in order to achieve good performance, Lidar calibration requires data from IMU, GPS, CAN sensors.</li>
</ul>
<h2>Output Requirements</h2>
<ul>
<li>Corrected roll/pitch/yaw value: less than 0.3 degrees</li>
<li>Corrected height value: less than 3 cm</li>
<li>Time to correction: less than 10 minutes for Lidar sensor with 10HZ spinning frequency</li>
</ul>
<h1>Cross-validation KPI</h1>
<p >Several hours of data are used to produce a reference calibration value for cross-validation. Then, short periods of data are evaluated for whether they can recover the same values. For example, the graph below shows precision/recall curves of Lidar self-calibration. Precision indicates that an accepted calibration is within a fixed precision threshold from the reference calibration, and recall indicates the ratio of accepted calibrations in the given amount of time.</p>
<div class="image">
<img src="self_calib_lidar_kpi.png" alt=""/>
</div>
    <h1>Workflow</h1>
<p >The following code snippet shows the general structure of a program that performs Lidar self-calibration</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a>(...);          <span class="comment">// depends on sensor from rig configuration module</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#gaecfa665203e2f294601ad6932c36d10d">dwCalibrationEngine_initializeLidar</a>(...);     <span class="comment">// depends on nominal calibration from rig configuration</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a>(...);    <span class="comment">// runtime calibration dependencies need to be met</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>) <span class="comment">// main loop</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// code to get IMU measurement</span></div>
<div class="line">    <span class="comment">// code to get CAN measurement</span></div>
<div class="line">    <span class="comment">// code to get GPS measurement</span></div>
<div class="line">    <span class="comment">// code to feed IMU, CAN and GPS measurements to vehicle egomotion</span></div>
<div class="line">    <span class="comment">// code to get lidar sweep</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get vehicle relative pose</span></div>
<div class="line">    <a class="code hl_struct" href="MatrixTypes_8h.html#structdwTransformation3f">dwTransformation3f</a> vehicleDeltaPose;</div>
<div class="line">    <a class="code hl_function" href="group__egomotion__group.html#gac050d4dcb967ff23105d1deef9e74244">dwEgomotion_computeRelativeTransformation</a>(&amp;vehicleDeltaPose, ...)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// get relative pose between two lidar sweeps</span></div>
<div class="line">    <a class="code hl_struct" href="MatrixTypes_8h.html#structdwTransformation3f">dwTransformation3f</a> lidarDeltaPose;</div>
<div class="line">    dwICP_optimize(&amp;lidarDeltaPose, ...)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// feed lidar point cloud into self-calibration</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#gaaa18c8a6c68fb38d4091ada57167310e">dwCalibrationEngine_addLidarPointCloud</a>(...)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// feed relative lidar and vehicle poses into self-calibration</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga06d838ca6ca94308251887b64b42b1a4">dwCalibrationEngine_addLidarPose</a>(...)</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve calibration status</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a>(...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve self-calibration results</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga95508c9a4e225e566dc21ca265672ac7">dwCalibrationEngine_getSensorToRigTransformation</a>(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a>(...);</div>
<div class="ttc" id="aMatrixTypes_8h_html_structdwTransformation3f"><div class="ttname"><a href="MatrixTypes_8h.html#structdwTransformation3f">dwTransformation3f</a></div><div class="ttdoc">Specifies a 3D rigid transformation.</div><div class="ttdef"><b>Definition:</b> <a href="MatrixTypes_8h_source.html#l00185">MatrixTypes.h:186</a></div></div>
<div class="ttc" id="agroup__calibration__group_html_ga06d838ca6ca94308251887b64b42b1a4"><div class="ttname"><a href="group__calibration__group.html#ga06d838ca6ca94308251887b64b42b1a4">dwCalibrationEngine_addLidarPose</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_addLidarPose(const dwTransformation3f *deltaPoseLidarTimeAToTimeB, const dwTransformation3f *deltaPoseRigTimeAToTimeB, dwTime_t timestampA, dwTime_t timestampB, uint32_t sensorIndex, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Adds lidar delta-poses and ego-motion delta poses to the calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga3ec3a048d476315d0debab207f5da156"><div class="ttname"><a href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getCalibrationStatus(dwCalibrationStatus *status, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current status of a calibration routine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga92ee0458420c6d398d3871303de98973"><div class="ttname"><a href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initialize(dwCalibrationEngineHandle_t *engine, dwRigHandle_t rig, dwContextHandle_t context)</div><div class="ttdoc">Creates and initializes a Calibration Engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga95508c9a4e225e566dc21ca265672ac7"><div class="ttname"><a href="group__calibration__group.html#ga95508c9a4e225e566dc21ca265672ac7">dwCalibrationEngine_getSensorToRigTransformation</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getSensorToRigTransformation(dwTransformation3f *sensorToRig, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current sensor to rig transformation of a calibration routine estimating this transformat...</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga9a509def08788c1876c8af2000af83ce"><div class="ttname"><a href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_startCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Starts a calibration routine associated with a calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gaaa18c8a6c68fb38d4091ada57167310e"><div class="ttname"><a href="group__calibration__group.html#gaaa18c8a6c68fb38d4091ada57167310e">dwCalibrationEngine_addLidarPointCloud</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_addLidarPointCloud(const dwVector4f *lidarPoints, uint32_t pointCount, dwTime_t timestamp, uint32_t sensorIndex, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Adds a lidar sweep to the calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gae4948b8898f6085b079670e049982e93"><div class="ttname"><a href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_stopCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Stops a calibration routine associated with a calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gaecfa665203e2f294601ad6932c36d10d"><div class="ttname"><a href="group__calibration__group.html#gaecfa665203e2f294601ad6932c36d10d">dwCalibrationEngine_initializeLidar</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initializeLidar(dwCalibrationRoutineHandle_t *routine, uint32_t lidarIndex, uint32_t canIndex, const dwCalibrationLidarParams *params, cudaStream_t stream, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Initializes a lidar calibration routine designated by the sensor provided to the method.</div></div>
<div class="ttc" id="agroup__egomotion__group_html_gac050d4dcb967ff23105d1deef9e74244"><div class="ttname"><a href="group__egomotion__group.html#gac050d4dcb967ff23105d1deef9e74244">dwEgomotion_computeRelativeTransformation</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwEgomotion_computeRelativeTransformation(dwTransformation3f *poseAtoB, dwEgomotionRelativeUncertainty *uncertainty, dwTime_t timestamp_a, dwTime_t timestamp_b, dwEgomotionConstHandle_t obj)</div><div class="ttdoc">Computes the relative transformation between two timestamps and the uncertainty of this transform.</div></div>
</div><!-- fragment --><p >This workflow is demonstrated in the following sample: <a class="el" href="dwx_lidar_calibration_sample.html">Lidar Calibration Sample</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
