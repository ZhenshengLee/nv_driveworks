<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Disparity Computation Workflow</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('stereo_usecase1.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Disparity Computation Workflow </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This section explains how to use NVIDIA<sup>&reg;</sup> DriveWorks Stereo Rectifier and Stereo to rectify two images of a stereo pair and compute a disparity map from them. The stereo disparity algorithm is based on a pair of Gaussian pyramids represented by two <code>::dwPyramidImage</code> objects that are built from a pair of rectified <code><a class="el" href="group__image__group.html#structdwImageCUDA" title="Defines a CUDA image.">dwImageCUDA</a></code> images.</p>
<h2>Step 1: Obtain the intrinsic and extrinsic camera parameters for the left and right camera</h2>
<p >Before you can initialize the stereo rectifier, you must first obtain the intrinsic and extrinsic camera parameters for the left and right camera.</p>
<p >The camera intrinsics encompass data such as focal length and principal point. The intrinsic parameters of each camera are represented by a <code><a class="el" href="group__cameramodel__group.html#ga167726213464d2e4b9b8aa9014de577f" title="A pointer to the handle representing a calibrated camera model.">dwCameraModelHandle_t</a></code> object. They can be obtained from the rig configuration as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Initialize left and right calibrated cameras containing the camera intrinsic parameters</span></div>
<div class="line"><a class="code hl_typedef" href="group__cameramodel__group.html#ga167726213464d2e4b9b8aa9014de577f">dwCameraModelHandle_t</a> cameraModelLeft, cameraModelRight;</div>
<div class="line"><a class="code hl_function" href="group__cameramodel__group.html#ga3f31497508cf72cc109c6f79869a5b57">dwCameraModel_initialize</a>(&amp;cameraModelLeft, leftCamera_ID, rigConfigurationHandle);</div>
<div class="line"><a class="code hl_function" href="group__cameramodel__group.html#ga3f31497508cf72cc109c6f79869a5b57">dwCameraModel_initialize</a>(&amp;cameraModelRight, rightCamera_ID, rigConfigurationHandle);</div>
<div class="ttc" id="agroup__cameramodel__group_html_ga167726213464d2e4b9b8aa9014de577f"><div class="ttname"><a href="group__cameramodel__group.html#ga167726213464d2e4b9b8aa9014de577f">dwCameraModelHandle_t</a></div><div class="ttdeci">struct dwCameraModelObject * dwCameraModelHandle_t</div><div class="ttdoc">A pointer to the handle representing a calibrated camera model.</div><div class="ttdef"><b>Definition:</b> <a href="CameraModel_8h_source.html#l00067">CameraModel.h:67</a></div></div>
<div class="ttc" id="agroup__cameramodel__group_html_ga3f31497508cf72cc109c6f79869a5b57"><div class="ttname"><a href="group__cameramodel__group.html#ga3f31497508cf72cc109c6f79869a5b57">dwCameraModel_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCameraModel_initialize(dwCameraModelHandle_t *camera, uint32_t sensorId, dwConstRigHandle_t obj)</div><div class="ttdoc">Creates a calibrated camera model polymorphically for a compatible sensor.</div></div>
</div><!-- fragment --><p >where <code>rigConfigurationHandle</code> is a previously initialized <code><a class="el" href="group__rig__configuration__group.html#ga69108a61f90f528053d6344ac49073f1" title="Handle representing the Rig interface.">dwRigHandle_t</a></code>; for more information on rig configuration see <a class="el" href="rig_mainsection.html">Rig Configuration</a>. <code>leftCamera_ID</code> and <code>rightCamera_ID</code> are the corresponding known camera IDs in the rig file.</p>
<p >The camera extrinsics encompass the misalignment of the camera with respect to the rig in terms of rotation and translation. The extrinsic parameters of each camera are represented by a <code>dwTransformation</code> object. They can be obtained from the rig configuration as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Get left and right camera extrinsic parameters from rig configuration</span></div>
<div class="line"><a class="code hl_struct" href="MatrixTypes_8h.html#structdwTransformation3f">dwTransformation3f</a> left2Rig, right2Rig;</div>
<div class="line"><a class="code hl_function" href="group__rig__configuration__group.html#ga80d66aeafcb7e2c2c700b8735a9e1327">dwRig_getSensorToRigTransformation</a>(&amp;left2Rig, leftCamera_ID , rigConfigurationHandle);</div>
<div class="line"><a class="code hl_function" href="group__rig__configuration__group.html#ga80d66aeafcb7e2c2c700b8735a9e1327">dwRig_getSensorToRigTransformation</a>(&amp;right2Rig, rightCamera_ID, rigConfigurationHandle);</div>
<div class="ttc" id="aMatrixTypes_8h_html_structdwTransformation3f"><div class="ttname"><a href="MatrixTypes_8h.html#structdwTransformation3f">dwTransformation3f</a></div><div class="ttdoc">Specifies a 3D rigid transformation.</div><div class="ttdef"><b>Definition:</b> <a href="MatrixTypes_8h_source.html#l00185">MatrixTypes.h:186</a></div></div>
<div class="ttc" id="agroup__rig__configuration__group_html_ga80d66aeafcb7e2c2c700b8735a9e1327"><div class="ttname"><a href="group__rig__configuration__group.html#ga80d66aeafcb7e2c2c700b8735a9e1327">dwRig_getSensorToRigTransformation</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwRig_getSensorToRigTransformation(dwTransformation3f *const transformation, uint32_t const sensorId, dwConstRigHandle_t const obj)</div><div class="ttdoc">Gets the sensor to rig transformation for a sensor.</div></div>
</div><!-- fragment --><h2>Step 2: Initialize the stereo rectifier and the stereo handle</h2>
<p >Once intrinsic and extrinsic parameters of both cameras are available, you can initialize the stereo rectifier handle <code><a class="el" href="group__stereo__group.html#ga89c7d7db493ecb7457dd681b3131e4cf" title="A pointer to the handle representing a stereo rectifier.">dwStereoRectifierHandle_t</a></code> as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// initialize stereo rectifier with intrinsic and extrinsic camera parameters</span></div>
<div class="line"><a class="code hl_typedef" href="group__stereo__group.html#ga89c7d7db493ecb7457dd681b3131e4cf">dwStereoRectifierHandle_t</a> stereoRectifier;</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#gaf1d596d22113384ace18267e4656770b">dwStereoRectifier_initialize</a>(stereoRectifier, cameraModelLeft, cameraModelRight, left2Rig, right2Rig, contextHandle);</div>
<div class="ttc" id="agroup__stereo__group_html_ga89c7d7db493ecb7457dd681b3131e4cf"><div class="ttname"><a href="group__stereo__group.html#ga89c7d7db493ecb7457dd681b3131e4cf">dwStereoRectifierHandle_t</a></div><div class="ttdeci">struct dwStereoRectifierObject * dwStereoRectifierHandle_t</div><div class="ttdoc">A pointer to the handle representing a stereo rectifier.</div><div class="ttdef"><b>Definition:</b> <a href="Stereo_8h_source.html#l00347">Stereo.h:347</a></div></div>
<div class="ttc" id="agroup__stereo__group_html_gaf1d596d22113384ace18267e4656770b"><div class="ttname"><a href="group__stereo__group.html#gaf1d596d22113384ace18267e4656770b">dwStereoRectifier_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereoRectifier_initialize(dwStereoRectifierHandle_t *obj, dwCameraModelHandle_t cameraLeft, dwCameraModelHandle_t cameraRight, dwTransformation3f leftToRig, dwTransformation3f rightToRig, dwContextHandle_t ctx)</div><div class="ttdoc">Initializes the stereo rectifier.</div></div>
</div><!-- fragment --><p >where <code>contextHandle</code> is a previously initialized <code><a class="el" href="group__timer__group.html#gae81934046206143539721bbe30b08a1e">dwContextHandle_t</a></code>.</p>
<p >To initialize a <code><a class="el" href="group__stereo__group.html#gaaddaf0ea4869694be0fd506016dcee74" title="A pointer to the handle representing a stereo algorithm.">dwStereoHandle_t</a></code> object, only <code><a class="el" href="group__stereo__group.html#structdwStereoParams" title="Configuration parameters for a Stereo algorithm.">dwStereoParams</a></code> is required. For example, the following example initializes stereo parameters with default values:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__stereo__group.html#structdwStereoParams">dwStereoParams</a> stereoParams{};</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga47884d3c68afeef7bb37dc704f3cdf18">dwStereo_initParams</a>(stereoParams);</div>
<div class="ttc" id="agroup__stereo__group_html_ga47884d3c68afeef7bb37dc704f3cdf18"><div class="ttname"><a href="group__stereo__group.html#ga47884d3c68afeef7bb37dc704f3cdf18">dwStereo_initParams</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereo_initParams(dwStereoParams *stereoParams)</div><div class="ttdoc">Initializes the stereo parameters.</div></div>
<div class="ttc" id="agroup__stereo__group_html_structdwStereoParams"><div class="ttname"><a href="group__stereo__group.html#structdwStereoParams">dwStereoParams</a></div><div class="ttdoc">Configuration parameters for a Stereo algorithm.</div><div class="ttdef"><b>Definition:</b> <a href="Stereo_8h_source.html#l00101">Stereo.h:102</a></div></div>
</div><!-- fragment --><p >And the following modifies the parameters according to application requirements:</p>
<div class="fragment"><div class="line"><span class="comment">// initialize some stereo parameters</span></div>
<div class="line">stereoParams.side = side;</div>
<div class="line">stereoParams.levelCount = levelCount;</div>
<div class="line">stereoParams.levelStop = levelStop;</div>
</div><!-- fragment --><p >For more information regarding all available parameters, please refer to the <code><a class="el" href="group__stereo__group.html#structdwStereoParams" title="Configuration parameters for a Stereo algorithm.">dwStereoParams</a></code> struct.</p>
<dl class="section note"><dt>Note</dt><dd>The effects due to different settings of the following <code><a class="el" href="group__stereo__group.html#structdwStereoParams" title="Configuration parameters for a Stereo algorithm.">dwStereoParams</a></code> parameters might be of special interest for the user:<ul>
<li><code>levelCount</code>: A larger value leads the algorithm to work at higher pyramid levels, which implies a larger context size but possibly more matching ambiguity due to loss of detail.</li>
<li><code>maxDisparityRange</code>: Smaller values can speed up the algorithm.</li>
<li><code>refinementLevel</code>: A high refinement level will lead to a smoother disparity map.</li>
<li><code>initType</code>: In general, it is advisable to always try several cost types, as their performance is dependent on the image content.</li>
</ul>
</dd></dl>
<p>After initializing the stereo parameters, initialize the module as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// initialize stereo module</span></div>
<div class="line"><a class="code hl_typedef" href="group__stereo__group.html#gaaddaf0ea4869694be0fd506016dcee74">dwStereoHandle_t</a> stereoAlgorithm;</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga93b2d12c3a2489a363b16b8f9c9f10f7">dwStereo_initialize</a>(stereoAlgorithm, imageWidth, imageHeight, stereoParams, contextHandle);</div>
<div class="ttc" id="agroup__stereo__group_html_ga93b2d12c3a2489a363b16b8f9c9f10f7"><div class="ttname"><a href="group__stereo__group.html#ga93b2d12c3a2489a363b16b8f9c9f10f7">dwStereo_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereo_initialize(dwStereoHandle_t *obj, uint32_t width, uint32_t height, const dwStereoParams *stereoParams, dwContextHandle_t ctx)</div><div class="ttdoc">Initializes the stereo algorithm with the parameters.</div></div>
<div class="ttc" id="agroup__stereo__group_html_gaaddaf0ea4869694be0fd506016dcee74"><div class="ttname"><a href="group__stereo__group.html#gaaddaf0ea4869694be0fd506016dcee74">dwStereoHandle_t</a></div><div class="ttdeci">struct dwStereoObject * dwStereoHandle_t</div><div class="ttdoc">A pointer to the handle representing a stereo algorithm.</div><div class="ttdef"><b>Definition:</b> <a href="Stereo_8h_source.html#l00065">Stereo.h:65</a></div></div>
</div><!-- fragment --><p >where <code>contextHandle</code> is assumed to be a previously initialized <code><a class="el" href="group__timer__group.html#gae81934046206143539721bbe30b08a1e">dwContextHandle_t</a></code>.</p>
<h2>Step 3: Retrieve the rectangular ROI shared by both images</h2>
<p >The rectification process applies a geometric transformation that projects the two images onto a common image plane. This plane contains a rectangular region that is shared by both images after rectification, graphically represented by the magenta boxes in the <a class="el" href="stereo_mainsection.html#stereo_module_image">module diagram</a>. It is represented by a <code><a class="el" href="GeometricDefs_8h.html#a6774f98f176cc36f30f256cbd6aa2b1b">dwBox2D</a></code> object, which can be retrieved as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Get resolution of output rectified images</span></div>
<div class="line"><a class="code hl_struct" href="GeometricTypes_8h.html#structdwRect">dwBox2D</a> roi;</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga9424b459ef0910b219092c57d122f44c">dwStereoRectifier_getCropROI</a>(&amp;roi, stereoRectifier);</div>
<div class="ttc" id="aGeometricTypes_8h_html_structdwRect"><div class="ttname"><a href="GeometricTypes_8h.html#structdwRect">dwRect</a></div><div class="ttdoc">Defines a rectangle.</div><div class="ttdef"><b>Definition:</b> <a href="GeometricTypes_8h_source.html#l00056">GeometricTypes.h:57</a></div></div>
<div class="ttc" id="agroup__stereo__group_html_ga9424b459ef0910b219092c57d122f44c"><div class="ttname"><a href="group__stereo__group.html#ga9424b459ef0910b219092c57d122f44c">dwStereoRectifier_getCropROI</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereoRectifier_getCropROI(dwBox2D *roi, dwStereoRectifierHandle_t obj)</div><div class="ttdoc">Returns a rectangle which is the roi where all valid pixels after undistortion and rectification are.</div></div>
</div><!-- fragment --><h2>Step 4: Create output images for the rectification process</h2>
<p >The knowledge of the region <code>roi</code> shall be used when creating the output images that will be passed to the rectification process. An example of this is given in the following snippet:</p>
<div class="fragment"><div class="line"><span class="comment">// Define image properties</span></div>
<div class="line"><a class="code hl_struct" href="group__image__group.html#structdwImageProperties">dwImageProperties</a> propsInput = imageProperties;</div>
<div class="line">propsInput.<a class="code hl_variable" href="group__image__group.html#a31480af9f96ef640b62acba393f6fc21">type</a> = <a class="code hl_enumvalue" href="group__image__group.html#gga6623e81a22d553d705467c56ba429c34a4ea518b96c3d6af3a0c77779facbb465">DW_IMAGE_CUDA</a>;</div>
<div class="line">propsInput.<a class="code hl_variable" href="group__image__group.html#ab0797520b7b3e416db1cacee3dc4b567">format</a> = <a class="code hl_enumvalue" href="group__image__group.html#ggab7343d2f61d8450ef8451d4ec73d087ca3bd3c4e72a8ef0652237783a22d1fd29">DW_IMAGE_FORMAT_RGBA_UINT8</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set width and height according to roi</span></div>
<div class="line">propsInput.<a class="code hl_variable" href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">width</a> = roi.<a class="code hl_variable" href="GeometricTypes_8h.html#a63e965ce02b17cbd99efa6997e6738d2">width</a>;</div>
<div class="line">propsInput.<a class="code hl_variable" href="group__image__group.html#a792907e1390890033c22c1865a431c8c">height</a> = roi.<a class="code hl_variable" href="GeometricTypes_8h.html#acd4d1d6b7fb58143f30ceb7c13d97a5b">height</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create output images</span></div>
<div class="line"><a class="code hl_typedef" href="group__image__group.html#ga0941eecdd67c03c4685bb895f0066f59">dwImageHandle_t</a> outputRectifiedLeft, outputRectifiedRight;</div>
<div class="line"><a class="code hl_function" href="group__image__group.html#ga8e16c1f43bb5f86cd4dc024d97fd3c5c">dwImage_create</a>(&amp;outputRectifiedLeft, propsInput, contextHandle);</div>
<div class="line"><a class="code hl_function" href="group__image__group.html#ga8e16c1f43bb5f86cd4dc024d97fd3c5c">dwImage_create</a>(&amp;outputRectifiedRight, propsInput, contextHandle);</div>
<div class="ttc" id="aGeometricTypes_8h_html_a63e965ce02b17cbd99efa6997e6738d2"><div class="ttname"><a href="GeometricTypes_8h.html#a63e965ce02b17cbd99efa6997e6738d2">dwRect::width</a></div><div class="ttdeci">int32_t width</div><div class="ttdef"><b>Definition:</b> <a href="GeometricTypes_8h_source.html#l00065">GeometricTypes.h:65</a></div></div>
<div class="ttc" id="aGeometricTypes_8h_html_acd4d1d6b7fb58143f30ceb7c13d97a5b"><div class="ttname"><a href="GeometricTypes_8h.html#acd4d1d6b7fb58143f30ceb7c13d97a5b">dwRect::height</a></div><div class="ttdeci">int32_t height</div><div class="ttdef"><b>Definition:</b> <a href="GeometricTypes_8h_source.html#l00068">GeometricTypes.h:68</a></div></div>
<div class="ttc" id="agroup__image__group_html_a31480af9f96ef640b62acba393f6fc21"><div class="ttname"><a href="group__image__group.html#a31480af9f96ef640b62acba393f6fc21">dwImageProperties::type</a></div><div class="ttdeci">dwImageType type</div><div class="ttdoc">Specifies the type of image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00392">Image.h:392</a></div></div>
<div class="ttc" id="agroup__image__group_html_a792907e1390890033c22c1865a431c8c"><div class="ttname"><a href="group__image__group.html#a792907e1390890033c22c1865a431c8c">dwImageProperties::height</a></div><div class="ttdeci">uint32_t height</div><div class="ttdoc">Specifies the height of the image in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00396">Image.h:396</a></div></div>
<div class="ttc" id="agroup__image__group_html_a9330ab25d52fe131e18e028f429c8fb2"><div class="ttname"><a href="group__image__group.html#a9330ab25d52fe131e18e028f429c8fb2">dwImageProperties::width</a></div><div class="ttdeci">uint32_t width</div><div class="ttdoc">Specifies the width of the image in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00394">Image.h:394</a></div></div>
<div class="ttc" id="agroup__image__group_html_ab0797520b7b3e416db1cacee3dc4b567"><div class="ttname"><a href="group__image__group.html#ab0797520b7b3e416db1cacee3dc4b567">dwImageProperties::format</a></div><div class="ttdeci">dwImageFormat format</div><div class="ttdoc">Specifies the format of the image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00398">Image.h:398</a></div></div>
<div class="ttc" id="agroup__image__group_html_ga0941eecdd67c03c4685bb895f0066f59"><div class="ttname"><a href="group__image__group.html#ga0941eecdd67c03c4685bb895f0066f59">dwImageHandle_t</a></div><div class="ttdeci">struct dwImageObject * dwImageHandle_t</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00102">Image.h:102</a></div></div>
<div class="ttc" id="agroup__image__group_html_ga8e16c1f43bb5f86cd4dc024d97fd3c5c"><div class="ttname"><a href="group__image__group.html#ga8e16c1f43bb5f86cd4dc024d97fd3c5c">dwImage_create</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwImage_create(dwImageHandle_t *const image, dwImageProperties properties, dwContextHandle_t const ctx)</div><div class="ttdoc">Creates and allocates resources for a dwImageHandle_t based on the properties passed as input.</div></div>
<div class="ttc" id="agroup__image__group_html_gga6623e81a22d553d705467c56ba429c34a4ea518b96c3d6af3a0c77779facbb465"><div class="ttname"><a href="group__image__group.html#gga6623e81a22d553d705467c56ba429c34a4ea518b96c3d6af3a0c77779facbb465">DW_IMAGE_CUDA</a></div><div class="ttdeci">@ DW_IMAGE_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00092">Image.h:92</a></div></div>
<div class="ttc" id="agroup__image__group_html_ggab7343d2f61d8450ef8451d4ec73d087ca3bd3c4e72a8ef0652237783a22d1fd29"><div class="ttname"><a href="group__image__group.html#ggab7343d2f61d8450ef8451d4ec73d087ca3bd3c4e72a8ef0652237783a22d1fd29">DW_IMAGE_FORMAT_RGBA_UINT8</a></div><div class="ttdeci">@ DW_IMAGE_FORMAT_RGBA_UINT8</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00144">Image.h:144</a></div></div>
<div class="ttc" id="agroup__image__group_html_structdwImageProperties"><div class="ttname"><a href="group__image__group.html#structdwImageProperties">dwImageProperties</a></div><div class="ttdoc">Defines the properties of the image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00389">Image.h:390</a></div></div>
</div><!-- fragment --><p >where <code>imageProperties</code> are known input image properties. Furthermore, you could use <code>roi</code> when creating image streamers for visualization purposes.</p>
<h2>Step 5: At runtime, call the stereo rectification process</h2>
<p >Execute the rectification process by calling <code><a class="el" href="group__stereo__group.html#gaffd8fdb8f3941bc7c2e1e60e9dbaf744" title="Rectifies two images acquired by a stereo rig, epipolar lines will be parallel.">dwStereoRectifier_rectify()</a></code>. In the following snippet, <code>stereoImageLeft</code> and <code>stereoImageRight</code> must have been obtained from two input videos or a single stereo camera.</p>
<div class="fragment"><div class="line"><span class="comment">// CODE: Get left and right frames, stereoImageLeft and stereoImageRight, as dwImageCUDA from two input videos or from a stereo camera</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Rectify pair of images</span></div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#gaffd8fdb8f3941bc7c2e1e60e9dbaf744">dwStereoRectifier_rectify</a>(outputRectifiedLeft, outputRectifiedRight, stereoImageLeft, stereoImageRight, stereoRectifier));</div>
<div class="ttc" id="agroup__stereo__group_html_gaffd8fdb8f3941bc7c2e1e60e9dbaf744"><div class="ttname"><a href="group__stereo__group.html#gaffd8fdb8f3941bc7c2e1e60e9dbaf744">dwStereoRectifier_rectify</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereoRectifier_rectify(dwImageCUDA *outputImageLeft, dwImageCUDA *outputImageRight, const dwImageCUDA *inputImageLeft, const dwImageCUDA *inputImageRight, dwStereoRectifierHandle_t obj)</div><div class="ttdoc">Rectifies two images acquired by a stereo rig, epipolar lines will be parallel.</div></div>
</div><!-- fragment --><p >where <code>outputRectifiedLeft</code> and <code>outputRectifiedRight</code> now contain the output rectified images.</p>
<h2>Step 6: At runtime, fill the Gaussian pyramids with the rectified frames</h2>
<p >At runtime, fill the left and right Gaussian pyramids with the rectified frames as follows:</p>
<div class="fragment"><div class="line">dwImageFilter_computePyramid(&amp;leftPyramid, &amp;outputRectifiedLeft, 0, context);</div>
<div class="line">dwImageFilter_computePyramid(&amp;rightPyramid, &amp;outputRectifiedRight, 0, context);</div>
</div><!-- fragment --><p> where <code>leftPyramid</code> and <code>rightPyramid</code> are <code>::dwPyramidImage</code> objects that have already been initialized.</p>
<dl class="section note"><dt>Note</dt><dd>The Stereo algorithm works with greyscale images only. Pyramid will select plane automatically if <code>outputRectifiedLeft</code> and <code>outputRectifiedRight</code> have more than one plane.</dd></dl>
<h2>Step 7: Compute the disparity map</h2>
<p >Call <code><a class="el" href="group__stereo__group.html#ga1864d075b44dd7d0f910ff40f0f305c2" title="Computes the disparity map given the two rectified views.">dwStereo_computeDisparity()</a></code> to compute the disparity map based on the parameters set in <code><a class="el" href="group__stereo__group.html#structdwStereoParams" title="Configuration parameters for a Stereo algorithm.">dwStereoParams</a></code>.</p>
<div class="fragment"><div class="line"><span class="comment">// Compute disparity given left and right pyramid</span></div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga1864d075b44dd7d0f910ff40f0f305c2">dwStereo_computeDisparity</a>(leftPyramid, rightPyramid, stereoAlgorithm));</div>
<div class="ttc" id="agroup__stereo__group_html_ga1864d075b44dd7d0f910ff40f0f305c2"><div class="ttname"><a href="group__stereo__group.html#ga1864d075b44dd7d0f910ff40f0f305c2">dwStereo_computeDisparity</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereo_computeDisparity(const dwPyramidImage *leftPyramid, const dwPyramidImage *rightPyramid, dwStereoHandle_t obj)</div><div class="ttdoc">Computes the disparity map given the two rectified views.</div></div>
</div><!-- fragment --><p ><code><a class="el" href="group__stereo__group.html#ga15f7ad3900393ced8978abbe07bbaa3a" title="Returns the disparity map for a specified side.">dwStereo_getDisparity()</a></code> can be called to retrieve the disparity map of the desired side.</p>
<div class="fragment"><div class="line"><span class="comment">// get disparity maps</span></div>
<div class="line"><span class="keyword">const</span> <a class="code hl_struct" href="group__image__group.html#structdwImageCUDA">dwImageCUDA</a> *disparityLeft, *disparityRight;</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga15f7ad3900393ced8978abbe07bbaa3a">dwStereo_getDisparity</a>(disparityLeft, <a class="code hl_enumvalue" href="group__stereo__group.html#ggaaa50aef1e3fde435c139c8179f1f55cca7314edcdcb079b2951958b9b329c62a3">DW_STEREO_SIDE_LEFT</a>, stereoAlgorithm);</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga15f7ad3900393ced8978abbe07bbaa3a">dwStereo_getDisparity</a>(disparityRight, <a class="code hl_enumvalue" href="group__stereo__group.html#ggaaa50aef1e3fde435c139c8179f1f55cca912d9558aa8e675cd17061eeb859168c">DW_STEREO_SIDE_RIGHT</a>, stereoAlgorithm));</div>
<div class="ttc" id="agroup__image__group_html_structdwImageCUDA"><div class="ttname"><a href="group__image__group.html#structdwImageCUDA">dwImageCUDA</a></div><div class="ttdoc">Defines a CUDA image.</div><div class="ttdef"><b>Definition:</b> <a href="image_2Image_8h_source.html#l00419">Image.h:420</a></div></div>
<div class="ttc" id="agroup__stereo__group_html_ga15f7ad3900393ced8978abbe07bbaa3a"><div class="ttname"><a href="group__stereo__group.html#ga15f7ad3900393ced8978abbe07bbaa3a">dwStereo_getDisparity</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereo_getDisparity(const dwImageCUDA **disparityMap, dwStereoSide side, dwStereoHandle_t obj)</div><div class="ttdoc">Returns the disparity map for a specified side.</div></div>
<div class="ttc" id="agroup__stereo__group_html_ggaaa50aef1e3fde435c139c8179f1f55cca7314edcdcb079b2951958b9b329c62a3"><div class="ttname"><a href="group__stereo__group.html#ggaaa50aef1e3fde435c139c8179f1f55cca7314edcdcb079b2951958b9b329c62a3">DW_STEREO_SIDE_LEFT</a></div><div class="ttdeci">@ DW_STEREO_SIDE_LEFT</div><div class="ttdoc">Left.</div><div class="ttdef"><b>Definition:</b> <a href="Stereo_8h_source.html#l00075">Stereo.h:75</a></div></div>
<div class="ttc" id="agroup__stereo__group_html_ggaaa50aef1e3fde435c139c8179f1f55cca912d9558aa8e675cd17061eeb859168c"><div class="ttname"><a href="group__stereo__group.html#ggaaa50aef1e3fde435c139c8179f1f55cca912d9558aa8e675cd17061eeb859168c">DW_STEREO_SIDE_RIGHT</a></div><div class="ttdeci">@ DW_STEREO_SIDE_RIGHT</div><div class="ttdoc">Right.</div><div class="ttdef"><b>Definition:</b> <a href="Stereo_8h_source.html#l00077">Stereo.h:77</a></div></div>
</div><!-- fragment --><h2>Step 8 (Optional): Get an estimation of the confidence associated with each map</h2>
<p >In cases where further processing is performed, it can be useful to have an estimation of the confidence associated to each disparity map.</p>
<p >To retrieve the confidence map of the corresponding disparity map, call <code><a class="el" href="group__stereo__group.html#ga17679c00d5a1a1a5337965b083290943" title="Returns the confidence map for a specified side.">dwStereo_getConfidence()</a></code> as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// get confidence maps</span></div>
<div class="line"><span class="keyword">const</span> <a class="code hl_struct" href="group__image__group.html#structdwImageCUDA">dwImageCUDA</a> *confidenceLeft, *confidenceRight;</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga17679c00d5a1a1a5337965b083290943">dwStereo_getConfidence</a>(confidenceLeft, <a class="code hl_enumvalue" href="group__stereo__group.html#ggaaa50aef1e3fde435c139c8179f1f55cca7314edcdcb079b2951958b9b329c62a3">DW_STEREO_SIDE_LEFT</a>, stereoAlgorithm);</div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga17679c00d5a1a1a5337965b083290943">dwStereo_getConfidence</a>(confidenceRight, <a class="code hl_enumvalue" href="group__stereo__group.html#ggaaa50aef1e3fde435c139c8179f1f55cca912d9558aa8e675cd17061eeb859168c">DW_STEREO_SIDE_RIGHT</a>, stereoAlgorithm);</div>
<div class="ttc" id="agroup__stereo__group_html_ga17679c00d5a1a1a5337965b083290943"><div class="ttname"><a href="group__stereo__group.html#ga17679c00d5a1a1a5337965b083290943">dwStereo_getConfidence</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereo_getConfidence(const dwImageCUDA **confidenceMap, dwStereoSide side, dwStereoHandle_t obj)</div><div class="ttdoc">Returns the confidence map for a specified side.</div></div>
</div><!-- fragment --><p >Confidence is defined as an 8-bit value, where:</p><ul>
<li>0 represents occlusion</li>
<li>1 represents an invalid disparity</li>
<li>Other values represent a confidence score where 255 is maximum and 2 is minimum</li>
</ul>
<p >An occlusion is a region of the image that is visible in one stereo image but not in the other. An invalid disparity is found in regions containing no information, and its value has no confidence.</p>
<p >To obtain a real occlusion in the confidence map, both disparity maps must be computed. If only one is computed, then the occlusion can be roughly found among low confidence pixels in the confidence map.</p>
<p >Extracting a disparity map with a resolution lower than that of the input images can greatly improve the runtime and smoothness of the result. However, this improvement comes at the expense of edge precision and overall estimation accuracy.</p>
<h2>Step 9: Release the stereo rectifier and stereo algorithm</h2>
<p >Finally, release the stereo rectifier and stereo algorithm as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Release stereo rectifier</span></div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga68b679360fb6d78fddaed912f6d99e86">dwStereoRectifier_release</a>(stereoRectifier);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Release stereo module</span></div>
<div class="line"><a class="code hl_function" href="group__stereo__group.html#ga597082693a10556e46910a7cc2a061f0">dwStereo_release</a>(stereoAlgorithm);</div>
<div class="ttc" id="agroup__stereo__group_html_ga597082693a10556e46910a7cc2a061f0"><div class="ttname"><a href="group__stereo__group.html#ga597082693a10556e46910a7cc2a061f0">dwStereo_release</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereo_release(dwStereoHandle_t obj)</div><div class="ttdoc">Releases the stereo algorithm.</div></div>
<div class="ttc" id="agroup__stereo__group_html_ga68b679360fb6d78fddaed912f6d99e86"><div class="ttname"><a href="group__stereo__group.html#ga68b679360fb6d78fddaed912f6d99e86">dwStereoRectifier_release</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwStereoRectifier_release(dwStereoRectifierHandle_t obj)</div><div class="ttdoc">Releases the stereo rectifier.</div></div>
</div><!-- fragment --><p >For more details see <a class="el" href="dwx_stereo_disparity_sample.html">Stereo Disparity Sample</a>, where it is shown how to perform image rectification and disparity estimation on a video pair. In the sample, horizontal lines are rendered to show how the pixels in both rectified images lay on the same horizontal line and the resulting disparity maps are visualized. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
