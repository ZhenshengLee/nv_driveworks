<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: CAN Message Logger Sample</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dwx_canbus_logger_sample.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CAN Message Logger Sample </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#dwx_canbus_logger_sample_description">Description</a></li>
<li class="level1"><a href="#dwx_canbus_logger_sample_running">Running the sample</a><ul><li class="level2"><a href="#dwx_canbus_logger_sample_examples">Examples</a></li>
</ul>
</li>
<li class="level1"><a href="#dwx_canbus_logger_sample_output">Output</a></li>
<li class="level1"><a href="#dwx_canbus_logger_sample_more">Additional Information</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="dwx_canbus_logger_sample_description"></a>
Description</h1>
<p >The CAN Message Logger sample is a simple CAN bus listener sample. All messages received over the CAN bus are printed on the console. A valid SocketCAN or AurixCAN device must be present in the system. Please refer to your platform datasheet for a description of the available CAN devices and the corresponding connectors.</p>
<h1><a class="anchor" id="dwx_canbus_logger_sample_running"></a>
Running the sample</h1>
<p >The CAN Message Logger sample, sample_canbus_logger, accepts the following parameters: </p><pre class="fragment">./sample_canbus_logger --driver=[can.virtual|can.socket|can.aurix|can.custom]
                       --params=[comma/separated/key/value/pairs]
                       --filter=[id1:mask1+id2:mask2+..]
                       --hwtime=[0|1]
                       --send_i_understand_implications=[timeout]
                       --send_id=[message_ID]
</pre><p> Where: </p><pre class="fragment">--driver=[can.virtual|can.socket|can.aurix|can.custom]
    Allows to specify which CAN interface to use.
    Default value: can.virtual

--params=[comma/separated/key/value/pairs]
    Different parameters are available for each CAN driver.
    Default value: file=path/to/data/samples/sfm/triangulation/canbus.can

--filter=[id1:mask1+id2:mask2+..]
    The sample provides support to filter (i.e., pass) messages of certain IDs. A
    filter can be specified by adding `+` separated `id:mask` values to the
    `--filter=` argument. A message is considered passing if `&lt;received_can_id&gt; &amp;
    mask == id &amp; mask`.
    Example 1 - pass all messages between 201-2FF: `--filter=200:F00`
    Example 2 - pass only 100,110 and 301-31F: `--filter=100:FFF+110:FFF+300:FE0`
    Example 3 - Empty filter. Pass all messages: `--filter=000:000`
    Default value: "" : No filter is applied. Note that filters may still be applied during initilization by `params` messages.

--hwtime=[0|1]
    DriveWorks supports hardware timestamps of the CAN messages for supported CAN bus devices.
    This can be disabled for by setting hwtime=0.
    In order for hardware timestamps to work for SocketCAN, the application must run with root rights.
    Default value: 1

--send_i_understand_implications=[timeout]
    Allows to generate a random CAN message each timeout ms
    Note that sending might interfere with real hardware; therefore, only
    use it if you know what you are doing.
    Default value: 0

--send_id=[message_ID]
    Allows to send message with a custom ID.
    This is only applicable if --send_i_understand_implications is not 0.
    Default value: 6FF

--send_size=[size]
    What size message should be sent.
    This is only applicable if --send_i_understand_implications is not 0.
    This results in sending non CAN FD messages if size is 0-8 and sending CAN FD messages if greater than 8.
    Valid range: 0-64
    Default value: 8
</pre> <dl class="section note"><dt>Note</dt><dd>For a full list of key/value pairs that can be passed to &ndash;params see <a class="el" href="dwx_sensor_enum_sample.html">Sensor Enumeration Sample</a> .</dd></dl>
<h2><a class="anchor" id="dwx_canbus_logger_sample_examples"></a>
Examples</h2>
<h4>Run with a Virtual CAN Device</h4>
<p >Test the applications using either a real CAN device or a virtual one. Create a virtual device using the following commands: </p><pre class="fragment">sudo modprobe vcan
sudo ip link add dev vcan0 type vcan
sudo ip link set vcan0 mtu 72  # if want to use Can-FD mode
sudo ip link set up vcan0
</pre><p> In order to send data from the console to the virtual CAN bus, use the <code>cansend</code> tool (from the <code>can-utils</code> package). </p><pre class="fragment">cansend vcan0 30B#1122334455667788
</pre><p> This example sends a CAN message with ID 0x30B and with 8-bytes containing: 0x11, ..., 0x88</p>
<p >If using the virtual CAN interface, the sample can be started with <code>--driver=can.socket --params=device=vcan0</code> to listen on the virtual CAN interface. Any message sent with <code>cansend vcan0</code> is displayed on the console.</p>
<dl class="section note"><dt>Note</dt><dd>the virtual CAN interface is not available on QNX</dd></dl>
<h4>Run with Real Hardware</h4>
<p >If using real-hardware connected to the CAN bus, set the bitrate to 500 KB in order to test the sample. The sample does not support changing of the bitrate. Set the bitrate on the CAN device by executing: </p><pre class="fragment">sudo ip link set can0 type can bitrate 500000
sudo ip link set can0 up
</pre> <dl class="section note"><dt>Note</dt><dd>the steps above are not needed on QNX</dd></dl>
<p>The CAN interface used to listen on a real CAN bus must have SocketCAN driver implementation in the system. A SocketCAN based driver can be identified easily if <code>:&gt; sudo ifconfig -a</code> returns the default network interfaces <b>and</b> a CAN based interface (i.e., canX, slcanX, etc).</p>
<h5>SocketCAN</h5>
<p >To execute the sample to listen on the SocketCAN connectors, use: </p><pre class="fragment">--driver=can.socket --params=device=can0
</pre> <h5>CANIP</h5>
<p >In NVIDIA DRIVESIM<sup>&trade;</sup> environments, CAN messages can be sent and received by CANIP servers. This is a TCP/UDP stream that allows the full access to the CAN implementations using a TCP/UDP network. </p><pre class="fragment"> --driver=can.nvidia-ip --params=host=127.0.0.1,port=10000,connection-type={udp,tcp}
</pre> <h5>AurixCAN</h5>
<p >On NVIDIA DRIVE<sup>&trade;</sup> platforms, CAN messages can be sent and received by the Xaviers through Aurix. For this to work, a proper setup of the Aurix needs to be made prior to running the application. In order to connect to AurixCAN, use the following arguments:</p>
<h6>For driveworks 3.5 and above (Aurix version 4.0 and above)</h6>
<p >&ndash;driver=can.aurix &ndash;params=ip=10.42.0.146,inIDMap=1:0x106+2:0x206,outIDMap=0x105:17+0x205:18</p>
<p >Where <code>ip</code> is the IP address from which the CAN messages are forwarded and <code>inIDMap/outIDMap</code> defines the mapping between PDU ID and CAN ID as defined by the security model of Aurix CAN. It has to match to the compiled into the Aurix security model. Please refer to the PDK documentation for more information about Aurix CAN security model.</p>
<h6>For driveworks 3.0 and below (Aurix version 3.X and below)</h6>
<p >&ndash;driver=can.aurix &ndash;params=ip=10.42.0.146,bus=a,config-file=/path/to/EasyCanConfigFile.conf</p>
<p >Where <code>ip</code> is the IP address from which the CAN messages are forwarded, <code>bus</code> points to the corresponding CAN bus connector, i.e., CAN-1-&gt;a, ..., CAN-4-&gt;d, and <code>config-file</code> points to an EasyCAN configuration file. Please refer to the EasyCAN user guide provided as part of PDK documentation to set up Aurix to filter and pass a selected subset of CAN messages. An example file is provided in the DriveWorks data folder, under /path/to/data/samples/sensors/can. Refer to the DriveWorks CAN bus documentation for more details on this file.</p>
<p >The connection to AurixCAN happens using UDP sockets. Additional arguments for the remote (<code>aport</code>) and local (<code>bport</code>) UDP port can be specified if AurixCAN is working in a non-default configuration. By default, on DRIVE AGX, AurixCAN is reachable over <code>aport=50000</code> and communicates with the Xavier over <code>bport=60395</code>.</p>
<h4>Message Sending</h4>
<p >Additionally, the sample can be used as a CAN message generator: </p><pre class="fragment">./sample_canbus_logger --send_i_understand_implications=100
</pre><p> in this case it generates a random CAN message each 100ms. Note that sending might interfere with real hardware; therefore, only use it if you know what you are doing.</p>
<h1><a class="anchor" id="dwx_canbus_logger_sample_output"></a>
Output</h1>
<p >The sample prints on console the received CAN messages: </p><pre class="fragment">5651471936 -&gt; 100  [5] 7E BB 02 00 00
5651471936 (dt=0) -&gt; 200  [5] 80 57 02 00 00
5651474567 (dt=2631) -&gt; 100  [5] A0 C1 02 00 00
5651474567 (dt=0) -&gt; 200  [5] 80 57 02 00 00
5651477205 (dt=2638) -&gt; 100  [5] A0 C1 02 00 00
5651477205 (dt=0) -&gt; 200  [5] 80 57 02 00 00
5651479850 (dt=2645) -&gt; 100  [5] A0 C1 02 00 00
5651479850 (dt=0) -&gt; 200  [5] 80 57 02 00 00
5651482733 (dt=2883) -&gt; 100  [5] A0 C1 02 00 00
5651482733 (dt=0) -&gt; 200  [5] 80 57 02 00 00
5651485391 (dt=2658) -&gt; 100  [5] 02 C9 02 00 00
5651485391 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651487984 (dt=2593) -&gt; 100  [5] 02 C9 02 00 00
5651487984 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651490645 (dt=2661) -&gt; 100  [5] 02 C9 02 00 00
5651490645 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651493322 (dt=2677) -&gt; 100  [5] 02 C9 02 00 00
5651493322 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651496024 (dt=2702) -&gt; 100  [5] 5A D0 02 00 00
5651496024 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651498602 (dt=2578) -&gt; 100  [5] 5A D0 02 00 00
5651498602 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651501306 (dt=2704) -&gt; 100  [5] 5A D0 02 00 00
5651501306 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651504039 (dt=2733) -&gt; 100  [5] 5A D0 02 00 00
5651504039 (dt=0) -&gt; 200  [5] 11 65 02 00 00
5651506639 (dt=2600) -&gt; 100  [5] 7C D6 02 00 00
</pre> <h5>AurixCAN and message sending</h5>
<p >For AurixCAN the selection of working CAN IDs is limited, i.e. either selected through <code>inIDMap/outIDMap</code> or using a configuration file passed with <code>config-file</code> option. Therefore the option <code>--send_i_understand_implications</code> should be used with <code>--send_id=</code> with a CAN ID matching an entry in the <code>outIDMap</code> list.</p>
<h1><a class="anchor" id="dwx_canbus_logger_sample_more"></a>
Additional Information</h1>
<p >For more details see <a class="el" href="canbus_mainsection.html">CAN Bus</a> . </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
