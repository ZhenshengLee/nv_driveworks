<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Receiving and Sending Data</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('canbus_usecase1.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Receiving and Sending Data </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="CAN_Bus_Sensor_Module_workflow"></a>
CAN Bus Sensor Module workflow</h1>
<h2>Initialization</h2>
<p >Initialization of the CAN bus sensor is achieved as follows:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__sensors__common__group.html#structdwSensorParams">dwSensorParams</a> params{};</div>
<div class="line">params.<a class="code hl_variable" href="group__sensors__common__group.html#ae345701d33349ba6794043c46ea0a52c">protocol</a> = <span class="stringliteral">&quot;can.socket&quot;</span>;</div>
<div class="line">params.parameters = <span class="stringliteral">&quot;device=can0&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="group__sensors__common__group.html#gadc6a1730acf17825ffa9620434b5959a">dwSensorHandle_t</a> canSensor;</div>
<div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga4004ff15b00f6e90cfe9aa43792be801">dwSAL_createSensor</a>(&amp;canSensor, params, ...);</div>
<div class="ttc" id="agroup__sensors__common__group_html_ae345701d33349ba6794043c46ea0a52c"><div class="ttname"><a href="group__sensors__common__group.html#ae345701d33349ba6794043c46ea0a52c">dwSensorParams::protocol</a></div><div class="ttdeci">const char8_t * protocol</div><div class="ttdoc">Name of the protocol.</div><div class="ttdef"><b>Definition:</b> <a href="Sensors_8h_source.html#l00099">Sensors.h:99</a></div></div>
<div class="ttc" id="agroup__sensors__common__group_html_ga4004ff15b00f6e90cfe9aa43792be801"><div class="ttname"><a href="group__sensors__common__group.html#ga4004ff15b00f6e90cfe9aa43792be801">dwSAL_createSensor</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSAL_createSensor(dwSensorHandle_t *const sensor, dwSensorParams const params, dwSALHandle_t const sal)</div><div class="ttdoc">Creates a new sensor managed by the SAL module with the given parameters.</div></div>
<div class="ttc" id="agroup__sensors__common__group_html_gadc6a1730acf17825ffa9620434b5959a"><div class="ttname"><a href="group__sensors__common__group.html#gadc6a1730acf17825ffa9620434b5959a">dwSensorHandle_t</a></div><div class="ttdeci">struct dwSensorObject * dwSensorHandle_t</div><div class="ttdoc">Handle representing a sensor.</div><div class="ttdef"><b>Definition:</b> <a href="Sensors_8h_source.html#l00086">Sensors.h:86</a></div></div>
<div class="ttc" id="agroup__sensors__common__group_html_structdwSensorParams"><div class="ttname"><a href="group__sensors__common__group.html#structdwSensorParams">dwSensorParams</a></div><div class="ttdoc">Holds sets of parameters for sensor creation.</div><div class="ttdef"><b>Definition:</b> <a href="Sensors_8h_source.html#l00094">Sensors.h:95</a></div></div>
</div><!-- fragment --><h2>Protocol</h2>
<p >The <code><a class="el" href="group__sensors__common__group.html#ae345701d33349ba6794043c46ea0a52c" title="Name of the protocol.">dwSensorParams.protocol</a></code> expects one of the following can interfaces:</p>
<ul>
<li><code>can.socket</code> interface for system CAN bus.</li>
<li><code>can.aurix</code> interface for CAN over Aurix.</li>
<li><code>can.virtual</code> interface for reading CAN data from binary logs.</li>
</ul>
<h2>Sensor parameters</h2>
<p >The <code><a class="el" href="group__sensors__common__group.html#ada918cb69f74cd07d306af18bcd43bf0" title="Array of additional parameters provided to sensor creation.">dwSensorParams.parameters</a></code> accepts the following parameters:</p>
<h3>For all:</h3>
<p ><code>filter=id:mask[+id:mask]</code>:</p>
<ul>
<li><code>filter</code> is a string of <code>+</code> seperated filters</li>
<li><code>id</code> is a hex value</li>
<li><code>mask</code> is a hex value</li>
</ul>
<p >Example: <code>filter=123:FFF+60A:FFF</code></p>
<p >See the <a class="el" href="canbus_usecase1.html#Setting_message_filters">Setting message filters</a> section to see how these values are used.</p>
<h3>When using <code>can.socket</code>:</h3>
<p ><code>device=can0[,fifo-size=1024]</code></p>
<ul>
<li><code>device</code> CAN device interface, usually canx, x starting from 0<ul>
<li>on Linux, use <code>ifconfig</code> to list available CAN interfaces</li>
<li>on QNX, use <code>pidin a | grep nvcan</code> to list available CAN interfaces</li>
</ul>
</li>
<li><code>fifo-size</code> size of internal buffer, in number of <code><a class="el" href="group__can__group.html#structdwCANMessage" title="Holds a CAN package.">dwCANMessage</a></code> stored.</li>
<li><code>discard-threshold</code> the timestamp of CAN data who is older than current timestamp by threshold will be discarded.<ul>
<li>only apply on QNX(CANQnx)</li>
</ul>
</li>
<li><code>read-number</code> data size to be read from driver buffer in one syscall, default number is 256<ul>
<li>only apply on QNX(CANQnx)</li>
</ul>
</li>
<li><code>do-not-send</code> disables send functionality when set to <code>true</code>.</li>
</ul>
<h3>When using <code>can.aurix</code> in driveworks 3.5 and above (Aurix version 4.0 and above):</h3>
<p ><code>ip=10.0.0.1,bus={a,b,c,d,e,f}[,aport=50000,bport=60395],[inIDMap=1:0x106+2:0x206][6,outIDMap=0x105:17+0x205:18][,fifo-size=1024]</code></p>
<ul>
<li><code>ip</code> IP of Aurix (Drive AGX: <code>10.42.0.146</code>).</li>
<li><code>aport</code> port on which CAN messages are sent to Aurix.</li>
<li><code>bport</code> port on which CAN messages are received from Aurix.</li>
<li><code>fifo-size</code> see above.</li>
<li><code>inIDMap</code> a mapping of PDU ID to CAN ID in the format pduID:canID seperated by '+'. This should match the security model compiled onto the Aurix. ID values in decimal or hex format with leading 0x. Messages recieved from Aurix with pduID will be mapped to matched canID.</li>
<li><code>outIDMap</code> a mapping of CAN ID to PDU ID in the format canID:pduUD seperated by '+'. This should match the security model compiled onto the Aurix. ID values in decimal or hex format with leading 0x. Messages with canID will be send to Aurix mapped to pduID.</li>
</ul>
<p >Note: Hardware timestamping is not available with Aurix version 4.0 and above.</p>
<h3>When using <code>can.aurix</code> in driveworks 3.0 and below (Aurix version 3.X and below)</h3>
<p ><code>ip=10.42.0.146,bus={a,b,c,d,e,f}[,aport=50000,bport=60395],[config-file=/path/to/EasyCanConfigFile.conf][,fifo-size=1024]</code></p>
<ul>
<li><code>ip</code> IP of Aurix (Drive AGX: <code>10.42.0.146</code>).</li>
<li><code>aport</code> port on which CAN messages are sent to Aurix.</li>
<li><code>bport</code> port on which CAN messages are received from Aurix.</li>
<li><code>fifo-size</code> see above.</li>
<li><code>bus</code> EasyCAN bus.</li>
<li><code>config-file</code> path to EasyCanConfigFile.conf, when provided, configures Aurix EasyCAN message routing when starting sensor. An example is provided in the DriveWorks data folder, under /path/to/data/samples/sensors/can.</li>
</ul>
<h3>When using <code>can.simulator</code>:</h3>
<p >Identical parameters to <code>can.socket</code>.</p>
<h3>When using <code>can.virtual</code>:</h3>
<p ><code>file=/path/to/file.can[,create_seek,default_timeout_us,time-offset=0]</code></p>
<ul>
<li><code>file</code> path to CAN bus recording</li>
<li><code>create_seek</code> create seek table</li>
<li><code>default_timeout_us</code> period after which sensor times out</li>
<li><code>time-offset</code> offset applied to CAN messages timestamps</li>
</ul>
<p >The CAN buses are setup with CAN FD if supported. If not supported sending and receiving CAN FD messages will fail.</p>
<h2>Starting, stopping and releasing sensor</h2>
<p >The CAN bus sensor can be started, stopped and released as follows:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga4451ef616b16704aa57b5eda2810f8c2">dwSensor_start</a>(canSensor);</div>
<div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga65b211709a6344856eb458c0ed128f12">dwSensor_stop</a>(canSensor);</div>
<div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga770fa0714d22dd11c8979ae6db5111b9">dwSAL_releaseSensor</a>(&amp;canSensor);</div>
<div class="ttc" id="agroup__sensors__common__group_html_ga4451ef616b16704aa57b5eda2810f8c2"><div class="ttname"><a href="group__sensors__common__group.html#ga4451ef616b16704aa57b5eda2810f8c2">dwSensor_start</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensor_start(dwSensorHandle_t const sensor)</div><div class="ttdoc">Starts the sensor previously successfully created with 'dwSAL_createSensor()'.</div></div>
<div class="ttc" id="agroup__sensors__common__group_html_ga65b211709a6344856eb458c0ed128f12"><div class="ttname"><a href="group__sensors__common__group.html#ga65b211709a6344856eb458c0ed128f12">dwSensor_stop</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensor_stop(dwSensorHandle_t const sensor)</div><div class="ttdoc">Stops the sensor.</div></div>
<div class="ttc" id="agroup__sensors__common__group_html_ga770fa0714d22dd11c8979ae6db5111b9"><div class="ttname"><a href="group__sensors__common__group.html#ga770fa0714d22dd11c8979ae6db5111b9">dwSAL_releaseSensor</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSAL_releaseSensor(dwSensorHandle_t const sensor)</div><div class="ttdoc">Releases a sensor managed by the SAL module.</div></div>
</div><!-- fragment --><h2>Reading CAN messages</h2>
<p >CAN messages can be read from the bus as follows:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__can__group.html#structdwCANMessage">dwCANMessage</a> msg{};</div>
<div class="line"><a class="code hl_enumeration" href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a> status = <a class="code hl_function" href="group__can__group.html#gad6d8c00535c550d544534122303cec1a">dwSensorCAN_readMessage</a>(&amp;msg, 10000, canSensor);</div>
<div class="ttc" id="agroup__can__group_html_gad6d8c00535c550d544534122303cec1a"><div class="ttname"><a href="group__can__group.html#gad6d8c00535c550d544534122303cec1a">dwSensorCAN_readMessage</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensorCAN_readMessage(dwCANMessage *const msg, dwTime_t const timeoutUs, dwSensorHandle_t const sensor)</div><div class="ttdoc">Reads a CAN packet with a given timeout from the CAN bus.</div></div>
<div class="ttc" id="agroup__can__group_html_structdwCANMessage"><div class="ttname"><a href="group__can__group.html#structdwCANMessage">dwCANMessage</a></div><div class="ttdoc">Holds a CAN package.</div><div class="ttdef"><b>Definition:</b> <a href="CAN_8h_source.html#l00112">CAN.h:113</a></div></div>
<div class="ttc" id="agroup__core__status__group_html_ga01e41060986cf4c0d618a8923846619b"><div class="ttname"><a href="group__core__status__group.html#ga01e41060986cf4c0d618a8923846619b">dwStatus</a></div><div class="ttdeci">dwStatus</div><div class="ttdoc">Status definition.</div><div class="ttdef"><b>Definition:</b> <a href="Status_8h_source.html#l00173">Status.h:173</a></div></div>
</div><!-- fragment --><p >This will populate a <code><a class="el" href="group__can__group.html#structdwCANMessage" title="Holds a CAN package.">dwCANMessage</a></code> structure with the next CAN message received on the bus, in this example waiting up to 10000us, or 10ms, for a message to arrive. Timeout can be set to <code><a class="el" href="group__core__basictypes__group.html#ga8b667529ddc3fe9e5982c8eac26e56ea" title="Special value of timestamp which means infinitely long duration, in microseconds.">DW_TIMEOUT_INFINITE</a></code> to indicate infinite waiting until new message arrives, or 0 to immediately return and only read messages already received. The <code><a class="el" href="group__can__group.html#structdwCANMessage" title="Holds a CAN package.">dwCANMessage</a></code> structure can hold up to 64 bytes to accommodate CAN FD messages.</p>
<p >To only read messages available in the internal queue, without reading new messages on the CAN bus, the <code><a class="el" href="group__can__group.html#gac3370e230d39eba2e03112824fa32709" title="Returns any CAN data previously processed through a RAW data stream.">dwSensorCAN_popMessage()</a></code> method can be used. Together with <code><a class="el" href="group__can__group.html#ga77b37064c0a319c3daa883d930359a9e" title="Decodes CAN data previously read as a RAW data stream into internal queue.">dwSensorCAN_processRawData()</a></code>, raw binary CAN data can be read and parsed in <code><a class="el" href="group__can__group.html#structdwCANMessage" title="Holds a CAN package.">dwCANMessage</a></code> format, see <a class="el" href="canbus_usecase2.html">Reading CAN Messages from Raw Data (Binary)</a>.</p>
<h2>Sending CAN messages</h2>
<p >CAN messages can be sent on the bus as follows:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__can__group.html#structdwCANMessage">dwCANMessage</a> msg{};</div>
<div class="line"> </div>
<div class="line">msg.<a class="code hl_variable" href="group__can__group.html#ae51901eec5128978bcd4ca31a5739124">id</a> = 0x123;</div>
<div class="line">msg.data[0] = 0xFF;</div>
<div class="line">msg.size = 1;</div>
<div class="line">msg.timestamp = 0;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__can__group.html#gad746719abb9bf690fec919869c5e93f4">dwSensorCAN_sendMessage</a>(&amp;msg, 10000, canSensor);</div>
<div class="ttc" id="agroup__can__group_html_ae51901eec5128978bcd4ca31a5739124"><div class="ttname"><a href="group__can__group.html#ae51901eec5128978bcd4ca31a5739124">dwCANMessage::id</a></div><div class="ttdeci">uint32_t id</div><div class="ttdoc">CAN ID of the message sender.</div><div class="ttdef"><b>Definition:</b> <a href="CAN_8h_source.html#l00118">CAN.h:118</a></div></div>
<div class="ttc" id="agroup__can__group_html_gad746719abb9bf690fec919869c5e93f4"><div class="ttname"><a href="group__can__group.html#gad746719abb9bf690fec919869c5e93f4">dwSensorCAN_sendMessage</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensorCAN_sendMessage(const dwCANMessage *const msg, dwTime_t const timeoutUs, dwSensorHandle_t const sensor)</div><div class="ttdoc">Sends a message over the CAN bus within a specified timeout.</div></div>
</div><!-- fragment --><p >This sends a message over the CAN bus within a specified timeout. A message is guaranteed to have been sent when this method returns <code>DW_SUCCESS</code>. The method can block for up-to the specified amount of time if a bus is blocked or previous <code><a class="el" href="group__can__group.html#gad6d8c00535c550d544534122303cec1a" title="Reads a CAN packet with a given timeout from the CAN bus.">dwSensorCAN_readMessage()</a></code> operation has not yet finished.</p>
<p >If the <code>msg.size</code> value is from 9 - 64, then the message will be sent as a CAN FD message.</p>
<h2><a class="anchor" id="Setting_message_filters"></a>
Setting message filters</h2>
<p >CAN messages be filtered by ID as follows:</p>
<div class="fragment"><div class="line">uint32_t ids[2] = {0x100, 0x6AB};</div>
<div class="line">uint32_t masks[2] = {0xF00, 0xFFF};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__can__group.html#ga3a472495baee677c10cb9da8ca207441">dwSensorCAN_setMessageFilter</a>(&amp;ids, &amp;masks, 2, canSensor);</div>
<div class="ttc" id="agroup__can__group_html_ga3a472495baee677c10cb9da8ca207441"><div class="ttname"><a href="group__can__group.html#ga3a472495baee677c10cb9da8ca207441">dwSensorCAN_setMessageFilter</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwSensorCAN_setMessageFilter(const uint32_t *ids, const uint32_t *masks, uint16_t num, dwSensorHandle_t sensor)</div><div class="ttdoc">Specifes a set of CAN IDs to be filtered.</div></div>
</div><!-- fragment --><p >This function takes an array of IDs and an array of masks to setup filters. Once the filters are set, only messages with IDs matching the filters will be read. Each call to the above will reset previously set filters. To reset all filtering, call the above with 0 as number of filters.</p>
<p >Internally, only messages that meet the following condition for at least one filter are read:</p>
<div class="fragment"><div class="line">(messageID &amp; mask) == (<span class="keywordtype">id</span> &amp; mask)</div>
</div><!-- fragment --><p >Masks are optional; when passing <code>NULL</code>, a default mask of <code>1FFFFFFF</code> is used.</p>
<h2>Setting hardware timestamping</h2>
<p >The <code><a class="el" href="group__can__group.html#gaf77f392e53a7ab6bbefbbf737984f19f" title="Enables or disables hardware timestamp of the CAN messages.">dwSensorCAN_setUseHwTimestamps()</a></code> function allows the user to enable or disable hardware timestamping of messages on compatible CAN Bus devices. By default, hardware timestamping is enabled if available, but can be turned off if the default behavior is not working properly with the current hardware stack.</p>
<p >The <code><a class="el" href="group__can__group.html#gad6d8c00535c550d544534122303cec1a" title="Reads a CAN packet with a given timeout from the CAN bus.">dwSensorCAN_readMessage()</a></code> function reads the next available CAN message with a given timeout. The function call is blocking, until a CAN message is available or the timeout is exceeded. Filters can be set with <code><a class="el" href="group__can__group.html#ga3a472495baee677c10cb9da8ca207441" title="Specifes a set of CAN IDs to be filtered.">dwSensorCAN_setMessageFilter()</a></code> so that only specific messages are read from the bus. Messages can be sent with <code><a class="el" href="group__can__group.html#gad746719abb9bf690fec919869c5e93f4" title="Sends a message over the CAN bus within a specified timeout.">dwSensorCAN_sendMessage()</a></code>.</p>
<p >The <code><a class="el" href="group__can__group.html#structdwCANMessage" title="Holds a CAN package.">dwCANMessage</a></code> structure holds a CAN message, consisting of a timestamp, an ID, message data (payload) and size. The CAN bus module supports the extended CAN frame format.</p>
<h2>Aurix version 3.01.3 information</h2>
<h2>Sending CAN messages over Aurix</h2>
<p >As of software version 3.01.3, the Aurix is configured to cyclically send CAN messages with IDs 0x10f to 0x114 on buses A through F. These message IDs should be considered as reserved as this behavior cannot be disabled at run-time. Please refer to the Elektrobit Aurix Software User Guide for more details.</p>
<h2>Sending CAN with FD (Flexible Data-Rate) and BRS (Bit Rate Switch)</h2>
<p >As of software version 3.05.4, the Aurix can send CAN FD messages with BRS. Note that this is configured to use timing sample points of 0.8. Devices on the network must be setup using this timing or bus errors can occur. Please refer to Drive Developer Guide, Flashing Aurix documentation for more information.</p>
<h2>Setting message routing on Aurix with config file</h2>
<p >A message routing configuration has to be sent to Aurix prior to running the application in order to receive, over Aurix, select CAN messages on the desired Xavier device(s). This can be done by providing an EasyCAN configuration file when creating the CAN bus sensor for <code>can.aurix</code> protocol, by specifying the path to an Aurix EasyCAN configuration file with the <code>config-file</code> argument. The configuration file is a text file containing the following structures, one per CAN message to be routed:</p>
<div class="fragment"><div class="line">MsgId   : 0x140</div>
<div class="line">CtrlId  : EC_CAN_BUS_E</div>
<div class="line">FrmTyp  : CAN_ID_STANDARD</div>
<div class="line">DestId  : TEGRA_DEVICE_A</div>
<div class="line">DestSwc : SWC_ID_CANDATA</div>
</div><!-- fragment --><p >Where:</p><ul>
<li><code>MsgId</code> is the message ID to be routed, in hexadecimal</li>
<li><code>CtrlId</code> is the EasyCAN bus on which the message is received, in range <code>EC_CAN_BUS_A</code> to <code>EC_CAN_BUS_F</code></li>
<li><code>FrmTyp</code> is the CAN ID type selector, either <code>CAN_ID_STANDARD</code> or <code>CAN_ID_EXTENDED</code></li>
<li><code>DestId</code> is the destination device, either <code>TEGRA_DEVICE_A</code> or <code>TEGRA_DEVICE_B</code></li>
<li><code>DestSwc</code> is set to <code>SWC_ID_CANDATA</code> for CAN data</li>
</ul>
<p >Each structure, corresponding to one CAN message to be routed, is separated by an empty line from the next. An example file is provided in the DriveWorks data folder, under /path/to/data/samples/sensors/can.</p>
<p >Please refer to the Elektrobit Aurix Software User Guide provided as part of PDK documentation for more information on the EasyCAN message routing feature and on how to configure Aurix. </p><h1>Example</h1>
<p >The following code shows the general structure of a program setting up CAN message filters and receiving/sending messages on the bus. Only messages with IDs <code>0x100</code>-<code>0x1FF</code> and <code>0x6AB</code> will be read.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__sensors__common__group.html#structdwSensorParams">dwSensorParams</a> params{};</div>
<div class="line">params.<a class="code hl_variable" href="group__sensors__common__group.html#ae345701d33349ba6794043c46ea0a52c">protocol</a> = <span class="stringliteral">&quot;can.socket&quot;</span>;</div>
<div class="line">params.parameters = <span class="stringliteral">&quot;device=can0&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="group__sensors__common__group.html#gadc6a1730acf17825ffa9620434b5959a">dwSensorHandle_t</a> canSensor;</div>
<div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga4004ff15b00f6e90cfe9aa43792be801">dwSAL_createSensor</a>(&amp;canSensor, params, ...);</div>
<div class="line"> </div>
<div class="line">uint32_t ids[2] = {0x100, 0x6AB};</div>
<div class="line">uint32_t masks[2] = {0xF00, 0xFFF};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__can__group.html#ga3a472495baee677c10cb9da8ca207441">dwSensorCAN_setMessageFilter</a>(&amp;ids, &amp;masks, 2, canSensor);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga4451ef616b16704aa57b5eda2810f8c2">dwSensor_start</a>(canSensor);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(loop)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="group__can__group.html#structdwCANMessage">dwCANMessage</a> msg{};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// read all messages until internal queue is empty</span></div>
<div class="line">    <span class="keywordflow">while</span>(<a class="code hl_function" href="group__can__group.html#gad6d8c00535c550d544534122303cec1a">dwSensorCAN_readMessage</a>(&amp;msg, 0, canSensor) == DW_SUCCESS)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// use received can message</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// send message, e.g. asking for more data</span></div>
<div class="line">    msg.<a class="code hl_variable" href="group__can__group.html#ae51901eec5128978bcd4ca31a5739124">id</a> = 0xAAA;</div>
<div class="line">    msg.data[0] = 0xFF;</div>
<div class="line">    msg.size = 1;</div>
<div class="line">    msg.timestamp = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// wait for 10ms at most if bus is busy</span></div>
<div class="line">    <a class="code hl_function" href="group__can__group.html#gad746719abb9bf690fec919869c5e93f4">dwSensorCAN_sendMessage</a>(&amp;msg, 10000, canSensor);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga65b211709a6344856eb458c0ed128f12">dwSensor_stop</a>(canSensor);</div>
<div class="line"><a class="code hl_function" href="group__sensors__common__group.html#ga770fa0714d22dd11c8979ae6db5111b9">dwSAL_releaseSensor</a>(&amp;canSensor);</div>
</div><!-- fragment --><p >For more information, refer to <a class="el" href="dwx_canbus_logger_sample.html">CAN Message Logger Sample</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
