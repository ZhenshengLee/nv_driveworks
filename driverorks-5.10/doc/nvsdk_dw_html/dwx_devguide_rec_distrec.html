<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Distributed Recording</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dwx_devguide_rec_distrec.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Distributed Recording </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#dwx_devguide_rec_distrec_basic">Basic Steps</a><ul><li class="level2"><a href="#dwx_recorder_usecase2_step_1">Step 1: Set up Xavier A &amp; B</a></li>
<li class="level2"><a href="#dwx_devguide_rec_distrec_step2">Step 2: Collect Rig Files</a></li>
<li class="level2"><a href="#dwx_devguide_rec_distrec_step3">Step 3: Synchronize and then run</a></li>
</ul>
</li>
<li class="level1"><a href="#dwx_devguide_rec_distrec_synch">Sensor Synchronization</a><ul><li class="level2"><a href="#dwx_devguide_rec_distrec_sync_same_1">Synchronizing for Distributed Recording</a></li>
<li class="level2"><a href="#dwx_devguide_rec_distrec_testing">Testing Sensor Synchronization</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p >This section provides guidance on synchroneously recording data on sensors distributed across multiple NVIDIA DRIVE<sup>&trade;</sup> platforms.</p>
<p >The diagram below shows two NVIDIA DRIVE platforms with the recording application, each collecting their own data. For each recorder, data is stored with a timestamp that records the time, in milliseconds. Data between the two NVIDIA DRIVE platforms are sycnronized based on timestamps. Multiple sensors allow for higher accuracy, and the exact timestamps ensure precise synchronization between the devices.</p>
<p ><img src="dwx_distributed_recording_app_overview.jpg" alt="" class="inline"/></p>
<p >Both the <a class="el" href="dwx_recorder_textui_tool.html">TextUI Recording Tool</a> and <a class="el" href="dwx_gui_recording2_tool.html">GUI Recording Tool</a> can support distributed recording with systems reachable by the network. The front-end instance of these tools launches multiple back-end instances on connected Xaviers and synchronizes them over UNIX pipes.</p>
<h1><a class="anchor" id="dwx_devguide_rec_distrec_basic"></a>
Basic Steps</h1>
<h2><a class="anchor" id="dwx_recorder_usecase2_step_1"></a>
Step 1: Set up Xavier A &amp; B</h2>
<p >On each Xavier:</p><ol type="1">
<li>Verify the Sensors Are Collecting Data in <a class="el" href="dwx_recording_devguide_basic_recording.html">Basic Recording</a>.</li>
<li>Create a DriveWorks Rig Configuration File for the sensor set.</li>
<li>Attach eSATA/USB storage.</li>
</ol>
<h2><a class="anchor" id="dwx_devguide_rec_distrec_step2"></a>
Step 2: Collect Rig Files</h2>
<p >On the master Xavier (either A or B), collect rig files for both Xavier A and B, and arrange them in the following directory structure: </p><pre class="fragment">&lt;rig_directory&gt;
|___10.42.0.28.json
|___10.42.0.29.json
</pre><p> Where each rig file name contains the IP address of that Xavier.</p>
<h2><a class="anchor" id="dwx_devguide_rec_distrec_step3"></a>
Step 3: Synchronize and then run</h2>
<ol type="1">
<li>Synchronize the Xavier clocks as described in Synchronizing system clocks in these release notes.</li>
<li>On the master Xavier, start the recording application, specifying the rig corresponding configuration file directory: <pre class="fragment"># tools/recorder-tui &lt;rig_directory&gt;
</pre> Recording is automatically toggled on Xavier B, when toggled on Xavier A.</li>
</ol>
<h1><a class="anchor" id="dwx_devguide_rec_distrec_synch"></a>
Sensor Synchronization</h1>
<p >NVIDIA DRIVE platforms can record sensor data for various sensor groups on the same Xavier or for various groups on different Xavier processors or NVIDIA DRIVE platforms. The sensor setting in the rig configuration file effects sensor timestamp synchronization. In addition, for recordings on different Xavier processors, other factors affect timestamp synchronization.</p>
<h2><a class="anchor" id="dwx_devguide_rec_distrec_sync_same_1"></a>
Synchronizing for Distributed Recording</h2>
<p >By default, the recorder tool does not provide synchronization in a distributed recording setting because PTP is off. But if you synchronize the system clocks with PTP or gPTP, then you can get synchronization within +/- 0.5 frames. If you record when PTP is off, recording timestamps are based on the current Xavier time, which might be not the real time when the recording takes place.</p>
<p >Cross-CSI sync is enabled automatically makes all cameras capture at the same time, HW wise. This will enable the external FSYNC feature of the deserializer and allow the Xavier PWM output to drive the camera sync for multiple camera groups</p>
<h3>About synchronization</h3>
<p >There are two types of synchronization.</p><ul>
<li><p class="startli">Synchronization of system clocks - Ensures that the timestamp from one Xavier is the same time as another Xavier.</p>
<p class="startli">With PTP or gPTP, you can achieve synchronization of system clocks.</p>
</li>
<li>Synchronization of camera frames - Ensures that the time of the capture is the same among multiple cameras.</li>
</ul>
<p >Synchronization of camera frames is not possible. During distributed recording, the Xavier processors control separate deserializers. They are not connected by the same PWM. Even though clocks are synchronized, sensor timing cannot be synchronized. As a result, the actual timing of the image capture cannot be synchronized, meaning that synchronization will be off by at most +/- 0.5 frames.</p>
<h3>How gPTP and PTP affect synchronization of system clocks</h3>
<p >The NVIDIA DRIVE PDK gPTP application provides the NVIDIA DRIVE platform support for 802.1AS conforming time synchronization messages for hardware time synchronization. gPTP is for multi-Xavier use cases (such as distributed recording), which requires time scales of each Xavier to be synchronized with each other. NVIDIA recommends enabling gPTP at all times.</p>
<h3>Synchronizing System Clocks</h3>
<p >Use either PTP or gPTP to synchronize between one Xavier as master and 3 other Xaviers as slaves. Depending on the execution timing, you should have +/- 0.5 frames difference between sensor timestamps when measuring the same camera with same framerate.</p>
<p >If PTP is running, have all peers start/stop recording at a predetermined timestamp value. For guidance on using gPTP, search the <em>NVIDIA DRIVE OS 5.1 Development Guide</em> for <code>PTP</code>.</p>
<h2><a class="anchor" id="dwx_devguide_rec_distrec_testing"></a>
Testing Sensor Synchronization</h2>
<p >You cannot compare the timestamp of the first frame to see if PTP sync worked. Recording does not start synchronously on both Xaviers. Instead, you must correlate images and then compare the timestamps on those images.</p>
<h3>To test sensor synchronization</h3>
<ol type="1">
<li>Observe with cameras from two Xaviers that are recording the same content, for example a video playing on a monitor.</li>
<li>Find corresponding frames in both video streams, by comparing the frame content.</li>
<li>Compare the timestamp of both frames.</li>
<li>Ensure the timestamps are within +/- 0.5 frames. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
