<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2009-2014 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>DriveWorks SDK Reference: Epipolar-based Stereo Self-Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="reverb-search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="nv.css" rel="stylesheet" type="text/css" />
<link href="nvdwx.css" rel="stylesheet" type="text/css"/>
<style>
 body {
 background-position: 350px 150px;
 background-image: url(watermark.png);
 background-repeat: no-repeat;
 background-attachment: fixed;
 }
 </style>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="99%" border="0" cellspacing="1" cellpadding="1">
  <tbody>
    <tr valign="middle">
      <td rowspan="2" height="44" width="19%">
        <div>
            <a id="nv-logo" href="https://www.nvidia.com/"></a>
        </div>
      <td width="81%" height="44">
        <div style="text-align:right; font-weight: bold; font-size:20px"> <br/>DriveWorks SDK Reference </div>
        <div style="text-align:right">
        5.10.87 Release <br/> For Test and Development only <br/> <br/> </div>
    </td>
  </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('calibration_usecase_stereo.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Epipolar-based Stereo Self-Calibration </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Operating Principle</h1>
<p >Given a horizontal stereo rig, the right camera's extrinsic pose calibration with respect to the left camera is represented by both orientation and position parameters.</p>
<p >Orientation parameters are defined as roll, pitch and yaw, while position parameters are defined as x, y, z. The orientation parameters identify the rotation that aligns the right camera orientation to the left camera orientation. The position parameters identify the translation between the right camera position and the left camera position. All six parameters are crucial in tasks such as stereo rectification and disparity estimation that rely on the relative pose of the right camera with respect to the left camera.</p>
<p >NVIDIA<sup>&reg;</sup> DriveWorks uses visually matched features to calibrate the right camera's orientation and position in a self-calibration setting. While orientation is calibrated fully, position is only calibrated up to norm, i.e., up to the relative translation between the two cameras specified in the rig file. All six parameters are calibrated simultaneously by estimating the transformation that best satisfies the epipolar constraint on the feature matches.</p>
<h2>Right Camera Roll / Pitch / Yaw / X / Y / Z</h2>
<p >The features obtained from the left image are matched to those obtained from the right image. Using the well-known epipolar constraint, the relative transformation between the left and the right camera is estimated. This relative transformation provides roll, pitch, yaw, as well as x, y, z components of the right camera with respect to the left camera.</p>
<p >The instantaneous calibration for an image pair is accumulated in histograms for the calibration's roll, pitch, yaw, x, y, z components to estimate a final calibration in a robust way.</p>
<div class="image">
<img src="self_calib_stereo_matches.png" alt=""/>
<div class="caption">
Matched features are represented by the same color in the top left and top right image tiles. Roll, pitch, yaw, inclination and azimuth histograms of an epipolar-calibrated stereo rig, collected over a period of time, are shown in the bottom tiles. Inclination and azimuth histogram are used to have a compact representation of the x, y, z translation component up to norm.</div></div>
    <h1>Requirements</h1>
<h2>Initialization Requirements</h2>
<ul>
<li>Nominal values on camera calibration<ul>
<li>Orientation(roll/pitch/yaw): roll/pitch/yaw less than 5 degree error</li>
<li>Position(x/y/z): less than 10 mm</li>
<li>Intrinsic calibration: accurate to 0.5 pixel</li>
</ul>
</li>
</ul>
<h2>Runtime Calibration Dependencies</h2>
<ul>
<li>IMU-based egomotion needs to be based on accurate IMU calibration and odometry properties</li>
</ul>
<h2>Input Requirements</h2>
<ul>
<li>Assumption: feature matches (right-to-left) compatible with DriveWork's module <a class="el" href="imageprocessing_features_mainsection.html">Features</a></li>
</ul>
<h2>Output Requirements</h2>
<ul>
<li>Corrected calibration for roll/pitch/yaw/x/y/z (mandatory)</li>
<li>Correction accuracy:<ul>
<li>roll/yaw: less than 0.10deg error</li>
<li>pitch: less than 0.2deg error</li>
<li>x/y/z: less than 2cm error</li>
</ul>
</li>
<li>Time/Events to correction:<ul>
<li>roll/pitch/yaw/x/y/z: less than 0:27 minutes in 75% of the cases, less than 0:49 minutes in 100% of the cases</li>
</ul>
</li>
</ul>
<h1>Cross-validation KPI</h1>
<p >Several hours of data are used to produce a reference calibration value for cross-validation. Then, short periods of data are evaluated for whether they can recover the same values. For example, the graph below shows precision/recall curves of stereo self-calibration. Precision indicates that an accepted calibration is within a fixed precision threshold from the reference calibration, and recall indicates the ratio of accepted calibrations in the given amount of time.</p>
<div class="image">
<img src="self_calib_stereo_kpi.png" alt=""/>
</div>
    <h1>Workflow</h1>
<p >The following code snippet shows the general structure of a program that performs stereo self-calibration</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="group__featureArray__group.html#structdwFeatureHistoryArray">dwFeatureHistoryArray</a> matchesHistoryGPU;   <span class="comment">// used by the features module</span></div>
<div class="line"><a class="code hl_struct" href="group__featureArray__group.html#structdwFeatureArray">dwFeatureArray</a> matchesDetectedGPU;         <span class="comment">// used by the features module</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a>(...);       <span class="comment">// depends on sensors from rig configuration module</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#ga5346dca9206a3906a638c4e5635b0444">dwCalibrationEngine_initializeStereo</a>(...); <span class="comment">// depends on nominal calibrations from rig configuration.</span></div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a>(...); <span class="comment">// runtime calibration dependencies need to be met</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(<span class="keyword">true</span>) <span class="comment">// main loop</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// track features for current left camera frame</span></div>
<div class="line">    <a class="code hl_function" href="group__feature2dtracker__group.html#gaad84b8d7ede7ae10a20222c061021079">dwFeature2DTracker_trackFeatures</a>(matchesHistoryGPU, ..., matchesDetectedGPU, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// detect features for current left camera frame</span></div>
<div class="line">    <a class="code hl_function" href="group__featureDetector__group.html#ga1edee131954d23a5952406c20f509ce0">dwFeature2DDetector_detectFromPyramid</a>(matchesDetectedGPU, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// track features for current right camera frame</span></div>
<div class="line">    <a class="code hl_function" href="group__feature2dtracker__group.html#gaad84b8d7ede7ae10a20222c061021079">dwFeature2DTracker_trackFeatures</a>(matchesHistoryGPU, ..., matchesDetectedGPU, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// detect features for current right camera frame</span></div>
<div class="line">    <a class="code hl_function" href="group__featureDetector__group.html#ga1edee131954d23a5952406c20f509ce0">dwFeature2DDetector_detectFromPyramid</a>(matchesDetectedGPU, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// feed feature matches into self-calibration</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga63acf5b530104ee9831ac041700dc1d4">dwCalibrationEngine_addMatches</a>(matchesHistoryGPU, ...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve calibration status</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a>(...);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// retrieve self-calibration results</span></div>
<div class="line">    <a class="code hl_function" href="group__calibration__group.html#gabb37f8cbe6162a0ff1e790a9ca929fbd">dwCalibrationEngine_getSensorToSensorTransformation</a>(...);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a>(...);</div>
<div class="ttc" id="agroup__calibration__group_html_ga3ec3a048d476315d0debab207f5da156"><div class="ttname"><a href="group__calibration__group.html#ga3ec3a048d476315d0debab207f5da156">dwCalibrationEngine_getCalibrationStatus</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getCalibrationStatus(dwCalibrationStatus *status, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current status of a calibration routine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga5346dca9206a3906a638c4e5635b0444"><div class="ttname"><a href="group__calibration__group.html#ga5346dca9206a3906a638c4e5635b0444">dwCalibrationEngine_initializeStereo</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initializeStereo(dwCalibrationRoutineHandle_t *routine, uint32_t vehicleSensorIndex, uint32_t leftSensorIndex, uint32_t rightSensorIndex, const dwCalibrationStereoParams *params, cudaStream_t stream, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">This method initializes a stereo camera pose calibration routine relative to the sensor index of the ...</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga63acf5b530104ee9831ac041700dc1d4"><div class="ttname"><a href="group__calibration__group.html#ga63acf5b530104ee9831ac041700dc1d4">dwCalibrationEngine_addMatches</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_addMatches(const dwFeatureHistoryArray *matches, dwTime_t timestamp, uint32_t leftSensorIndex, uint32_t rightSensorIndex, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Adds detected visual feature matches to the calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga92ee0458420c6d398d3871303de98973"><div class="ttname"><a href="group__calibration__group.html#ga92ee0458420c6d398d3871303de98973">dwCalibrationEngine_initialize</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_initialize(dwCalibrationEngineHandle_t *engine, dwRigHandle_t rig, dwContextHandle_t context)</div><div class="ttdoc">Creates and initializes a Calibration Engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_ga9a509def08788c1876c8af2000af83ce"><div class="ttname"><a href="group__calibration__group.html#ga9a509def08788c1876c8af2000af83ce">dwCalibrationEngine_startCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_startCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Starts a calibration routine associated with a calibration engine.</div></div>
<div class="ttc" id="agroup__calibration__group_html_gabb37f8cbe6162a0ff1e790a9ca929fbd"><div class="ttname"><a href="group__calibration__group.html#gabb37f8cbe6162a0ff1e790a9ca929fbd">dwCalibrationEngine_getSensorToSensorTransformation</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_getSensorToSensorTransformation(dwTransformation3f *sensorToSensor, uint32_t indexA, uint32_t indexB, dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Returns the current sensor to sensor transformation of a calibration routine estimating this transfor...</div></div>
<div class="ttc" id="agroup__calibration__group_html_gae4948b8898f6085b079670e049982e93"><div class="ttname"><a href="group__calibration__group.html#gae4948b8898f6085b079670e049982e93">dwCalibrationEngine_stopCalibration</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwCalibrationEngine_stopCalibration(dwCalibrationRoutineHandle_t routine, dwCalibrationEngineHandle_t engine)</div><div class="ttdoc">Stops a calibration routine associated with a calibration engine.</div></div>
<div class="ttc" id="agroup__feature2dtracker__group_html_gaad84b8d7ede7ae10a20222c061021079"><div class="ttname"><a href="group__feature2dtracker__group.html#gaad84b8d7ede7ae10a20222c061021079">dwFeature2DTracker_trackFeatures</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwFeature2DTracker_trackFeatures(dwFeatureHistoryArray *featureHistoryArray, dwFeatureArray *predictedFeatures, float32_t *d_normalizedCrossCorrelation, const dwFeatureArray *featuresToTrack, const dwVector2f *d_predictedPositions, const dwPyramidImage *previousPyramid, const dwPyramidImage *currentPyramid, dwFeature2DTrackerHandle_t obj)</div><div class="ttdoc">Tracks features and store the tracked results to predictedFeatures between the previous and current i...</div></div>
<div class="ttc" id="agroup__featureArray__group_html_structdwFeatureArray"><div class="ttname"><a href="group__featureArray__group.html#structdwFeatureArray">dwFeatureArray</a></div><div class="ttdef"><b>Definition:</b> <a href="FeatureList_8h_source.html#l00136">FeatureList.h:137</a></div></div>
<div class="ttc" id="agroup__featureArray__group_html_structdwFeatureHistoryArray"><div class="ttname"><a href="group__featureArray__group.html#structdwFeatureHistoryArray">dwFeatureHistoryArray</a></div><div class="ttdoc">Holds pointers to the data exposed by a feature2d list.</div><div class="ttdef"><b>Definition:</b> <a href="FeatureList_8h_source.html#l00115">FeatureList.h:116</a></div></div>
<div class="ttc" id="agroup__featureDetector__group_html_ga1edee131954d23a5952406c20f509ce0"><div class="ttname"><a href="group__featureDetector__group.html#ga1edee131954d23a5952406c20f509ce0">dwFeature2DDetector_detectFromPyramid</a></div><div class="ttdeci">DW_API_PUBLIC dwStatus dwFeature2DDetector_detectFromPyramid(dwFeatureArray *outputDetections, const dwPyramidImage *pyramid, dwFeatureArray *preTrackedFeatures, const float32_t *d_normalizedCrossCorrelation, dwFeature2DDetectorHandle_t obj)</div><div class="ttdoc">Detects new features and append them after old tracked features.</div></div>
</div><!-- fragment --><p >This workflow is demonstrated in the following sample: <a class="el" href="dwx_stereo_calibration_sample.html">Stereo Calibration Sample</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">
        Advance Information | Subject to Change |
        Prepared and Provided under NDA | Generated by NVIDIA |
        PR-08397-V5.0
      </li>
     </ul>
  </div>
</body>
</html>
