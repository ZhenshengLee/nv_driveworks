<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2022 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Compute Graph Framework SDK Reference: CGF Channel Sample</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="nv.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 110px;">
  <td id="projectlogo" width="19%">
    <a id="nv-logo" href="https://www.nvidia.com/"></a>
  </td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Compute Graph Framework SDK Reference
   &#160;<span id="projectnumber">5.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cgf_samples_channel.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CGF Channel Sample </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#description-cgf-dwchannel-sample">Description</a></li>
<li class="level1"><a href="#running-the-cgf-dwchannel-sample">Running the Sample</a></li>
<li class="level1"><a href="#examples-cgf-dwchannel">Examples</a><ul><li class="level2"><a href="#enlarge-networkstage">Enlarge NetworkStage if necessary</a></li>
<li class="level2"><a href="#add-nvsciipc-endpoints">Add nvsciipc endpoints if necessary</a></li>
<li class="level2"><a href="#understanding-c2c-nvsciipc-endpoints">Understanding C2C nvsciipc endpoints</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="description-cgf-dwchannel-sample"></a>
Description</h1>
<p >The CGF Channel Standalone Sample demonstrates the usage of CGF Channel without the context of a CGF graphlet or application.</p>
<h1><a class="anchor" id="running-the-cgf-dwchannel-sample"></a>
Running the Sample</h1>
<p >The command line for the sample is: </p><pre class="fragment">./sample_cgf_dwchannel --prod=[0|1]
                   --downstreams=[1,4]
                   --cons=[1,4]
                   --ip=[IP Address]
                   --port=[Socket Port or ID]
                   --mode=[mailbox|reuse|[N]]
                   --type=[SOCKET|SHMEM_LOCAL|NVSCI]
</pre><p> where </p><pre class="fragment">--prod=[0|1]
    Have producer in this process our not.
    Ignored if type=NVSCI
    Default value: 1

--downstreams=[1,4]
    Number of downstreams of producer.
    Ignored if type=NVSCI
    Default value: 1

--cons=[1,4]
    Number of consumers in this process.
    Ignored if type=NVSCI
    Default value: 1

--ip=[STR]
    IP Address of the source port.
    Ignored if type=NVSCI
    Default value: 127.0.0.1

--port=[INT]
    SOCKET Port Number or port ID under SHMEM_LOCAL.
    Ignored if type=NVSCI
    Default value: 40002

--mode=[mailbox|reuse|[N]]
    If the value is a number, it means the size of fifo channel.
    mailbox means only one packet in channel, and it will be overwritted after come a new packet.
    reuse is based on mailbox, the channel will always keep the latest packet.
    Default value: 4

--type=[SOCKET|SHMEM_LOCAL|NVSCI]
    Socket channel, local shared memory channel, or nvsci channel.
    Default value: SOCKET

--prod-reaches=[STR]
    Colon-separated list of producer reaches (process|chip)
    For NVSCI mode only
    Default value: ""

--prod-stream-names=[STR]
    colon-separated list of producer nvsciipc endpoints
    For NVSCI mode only
    Default value: ""

--cons-reaches=[STR]
    Colon-separated list of consumer reaches (process|chip)
    For NVSCI mode only
    Default value: ""

--cons-stream-names=[STR]
    colon-separated list of consumer nvsciipc endpoints
    For NVSCI mode only
    Default value: ""

--dataType=[int|dwImage]
    the type of data to be transferred.
    Default value: "dwImage"

--frames=N
    the number of frames to run the sample.
    Default value: 128

--sync-mode=[none|p2c|c2p|both]
    the synchronization mode for exchanging buffers.
    none: all data buffers are exchanged synchronously.
    p2c: data buffers are written asynchronous from producer send.
    c2p: data buffers are read asynchronous from consumer read.
    both: both p2c and c2p synchronization.
    For NVSCI mode only
</pre> <h1><a class="anchor" id="examples-cgf-dwchannel"></a>
Examples</h1>
<p >To run a default (inter process peer to peer with socket): </p><pre class="fragment">./sample_cgf_dwchannel
</pre><p> To run intra-process socket broadcast: </p><pre class="fragment">./sample_cgf_dwchannel --prod=1 --downstreams=2 --cons=2
</pre><p> To run intra-process nvscistream broadcast: </p><pre class="fragment">./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscisync_a_0:nvscisync_b_0 --prod-reaches=process:process --cons-stream-names=nvscisync_a_1:nvscisync_b_1 --cons-reaches=process:process
</pre><p> To run inter-process socket: </p><pre class="fragment">./sample_cgf_dwchannel --cons=1 --prod=0 --downstreams=0
./sample_cgf_dwchannel --prod=1 --downstreams=1 --cons=0
</pre><p> To run inter-process socket with custom data type: ./sample_cgf_dwchannel &ndash;cons=1 &ndash;prod=0 &ndash;downstreams=0 &ndash;dataType=custom ./sample_cgf_dwchannel &ndash;prod=1 &ndash;downstreams=1 &ndash;cons=0 &ndash;dataType=custom</p>
<p >To run inter-process nvscistream: </p><pre class="fragment">./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscisync_a_0 --prod-reaches=process
./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscisync_a_1 --cons-reaches=process
</pre><p> To run inter-process nvscistream with custom data type: ./sample_cgf_dwchannel &ndash;type=NVSCI &ndash;prod-stream-names=nvscisync_a_0 &ndash;prod-reaches=process &ndash;dataType=custom ./sample_cgf_dwchannel &ndash;type=NVSCI &ndash;cons-stream-names=nvscisync_a_1 &ndash;cons-reaches=process &ndash;dataType=custom</p>
<p >To run inter-process nvscistream with asynchronous writes: </p><pre class="fragment">./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscisync_a_0 --prod-reaches=process --sync-mode=p2c
./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscisync_a_1 --cons-reaches=process --sync-mode=p2c
</pre><p> To run intra-inter-process socket broadcast: </p><pre class="fragment">./sample_cgf_dwchannel --cons=1 --prod=0 --downstreams=0
./sample_cgf_dwchannel --prod=1 --downstreams=2 --cons=1
</pre><p> To run intra-inter-process nvscistream broadcast: </p><pre class="fragment">./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscisync_a_0:nvscisync_b_0 --prod-reaches=process:process
./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscisync_a_1:nvscisync_b_1 --cons-reaches=process:process
</pre><p> To run C2C socket peer to peer:</p>
<ul>
<li>Tegra Consumer: <pre class="fragment">./sample_cgf_dwchannel --cons=1 --prod=0 --downstreams=0 --ip=${IP} --port=${ID}
</pre></li>
<li>Tegra Producer: <pre class="fragment">./sample_cgf_dwchannel --cons=0 --ip=${IP} --port=${ID}
</pre></li>
</ul>
<p >To run C2C nvscistream PCIE peer-to-peer:</p>
<ul>
<li>On Dual Firespray Tegra A: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscic2c_pcie_s0_c6_1 --prod-reaches=chip
</pre></li>
<li>On Dual Firespray Tegra B: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscic2c_pcie_s0_c5_1 --cons-reaches=chip
</pre></li>
</ul>
<p >To run C2C nvscistream PCIE peer-to-peer with asynchronous writes:</p>
<ul>
<li>On Dual Firespray Tegra A: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscic2c_pcie_s0_c6_1 --prod-reaches=chip --sync-mode=p2c
</pre></li>
<li>On Dual Firespray Tegra B: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscic2c_pcie_s0_c5_1 --cons-reaches=chip --sync-mode=p2c
</pre></li>
</ul>
<p >To run C2C socket broadcast:</p>
<ul>
<li>Tegra Consumer: <pre class="fragment">./sample_cgf_dwchannel --cons=1 --prod=0 --downstreams=0 --ip=${IP} --port=${ID}
</pre></li>
<li>Tegra Producer: <pre class="fragment">./sample_cgf_dwchannel --prod=1 --downstreams=2 --cons=1 --ip=${IP} --port=${ID}
</pre></li>
</ul>
<p >To run C2C nvscistream PCIE broadcast:</p>
<ul>
<li>On Dual Firespray Tegra A: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscic2c_pcie_s0_c6_1:nvscic2c_pcie_s0_c6_2 --prod-reaches=chip:chip
</pre></li>
<li>On Dual Firespray Tegra B: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscic2c_pcie_s0_c5_1:nvscic2c_pcie_s0_c5_2 --cons-reaches=chip:chip
</pre></li>
</ul>
<p >To run hybrid inter-process, inter-chip nvscistream:</p>
<ul>
<li>On Dual Firespray Tegra A: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --prod-stream-names=nvscisync_a_0:nvscic2c_pcie_s0_c6_1 --prod-reaches=process:chip
sudo ./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscisync_a_1 --cons-reaches=process
</pre></li>
<li>On Dual Firespray Tegra B: <pre class="fragment">sudo ./sample_cgf_dwchannel --type=NVSCI --cons-stream-names=nvscic2c_pcie_s0_c5_1 --cons-reaches=chip
</pre> </li>
</ul>
<h2><a class="anchor" id="enlarge-networkstage"></a>
Enlarge NetworkStage if necessary</h2>
<pre class="fragment">sudo sed -i '$ a net.core.wmem_max = 65011712' /etc/sysctl.conf
sudo sed -i '$ a net.core.rmem_max = 65011712' /etc/sysctl.conf
sudo sed -i '$ a net.core.rmem_default = 16777216' /etc/sysctl.conf
sudo sed -i '$ a net.ipv4.tcp_wmem = 65011712 65011712 65011712' /etc/sysctl.conf
sudo sed -i '$ a net.ipv4.tcp_rmem = 65011712 65011712 65011712' /etc/sysctl.conf
sudo sysctl -p
</pre> <h2><a class="anchor" id="add-nvsciipc-endpoints"></a>
Add nvsciipc endpoints if necessary</h2>
<p >On linux, the nvsciipc endpoints should be listed under /etc/nvsciipc.cfg to be viewed. See the /etc/nvsciipc.cfg file to understand the format of endpoints. If modified the system must be rebooted before the changes will take affect. For C2C use-cases, the nvsciipc endpoints are configured in the device tree and are associated with a specific peer SoC on the platform. Please see DRIVE OS release documentation for further information about how to configure the C2C endpoints.</p>
<h2><a class="anchor" id="understanding-c2c-nvsciipc-endpoints"></a>
Understanding C2C nvsciipc endpoints</h2>
<p >Each endpoint can only be used by the Tegra that owns the corresponding PCIe port for the endpoint. In default P3710 (Firespray) Dual Configuration, the nvsciipc endpoints are listed as follows: </p><pre class="fragment">INTER_CHIP      nvscic2c_pcie_s0_c[5-6]_[1-12)    0000
</pre><p> Endpoints with c5 are end-port (EP) endpoints on the PCIe bus. Endpoints with c6 are toot-port (RP) endpoints on the PCIe bus. The EP and RP namings are for HW node identification, and do not signify direction of allowed data flows. Each pair of connected endpoints may transfer data in either direction. c6 is connected to Tegra A while c5 is connected to Tegra B. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
