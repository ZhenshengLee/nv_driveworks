<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--
 * Copyright (c) 2022 NVIDIA CORPORATION.  All rights reserved.
 *
 * NVIDIA Corporation and its licensors retain all intellectual property
 * and proprietary rights in and to this software, related documentation
 * and any modifications thereto.  Any use, reproduction, disclosure or
 * distribution of this software and related documentation without an express
 * license agreement from NVIDIA Corporation is strictly prohibited.
-->
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Compute Graph Framework SDK Reference: Schedule Switching</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="Nvidia.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="nv.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 110px;">
  <td id="projectlogo" width="19%">
    <a id="nv-logo" href="https://www.nvidia.com/"></a>
  </td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Compute Graph Framework SDK Reference
   &#160;<span id="projectnumber">5.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('cgf_schedule_switching.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Schedule Switching </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#system-context-schedule-switching">Extended System Context</a></li>
<li class="level1"><a href="#state-change-request">State Change Request</a></li>
<li class="level1"><a href="#on-state-change">On State Change</a></li>
<li class="level1"><a href="#references-schedule-switching">References</a></li>
</ul>
</div>
<div class="textblock"><p >A single data pipeline and schedule might not be sufficient for all use cases. Therefore, an application can define more than one state, each associated with it's own STM schedule.</p>
<p >Different schedules can vary in the set of nodes they include (beside other schedule properties) which effectively changes the data pipeline since parts of the data pipeline are enabled / disabled. But the instantiated nodes and channels effectively don't change.</p>
<p >The request to change the state during runtime is coming from the <a class="el" href="cgf_ssm.html">System State Manager</a>. If an application has more than one state, an additional process is being invoked by the launcher. The <b>schedule manager</b> process connects to SSM and waits for state change requests.</p>
<h1><a class="anchor" id="system-context-schedule-switching"></a>
Extended System Context</h1>
<p >The extended system context - highlighting the new entities - is depicted in the following diagram:</p>
<div class="plantumlgraph">
<img src="system_context_with_ssm.png" />
<div class="caption">
System Context with SSM</div>
</div>
<h1><a class="anchor" id="state-change-request"></a>
State Change Request</h1>
<p >When a state change a request is received the schedule manager can respond in two different ways:</p>
<ul>
<li>reject the state change request (e.g. because the requested schedule is not ready since not all nodes part of that schedule have been loaded yet) or</li>
<li>accept the state change request and start the switching.</li>
</ul>
<h1><a class="anchor" id="on-state-change"></a>
On State Change</h1>
<p >The switching happens in three sequential steps:</p>
<ol type="1">
<li>The current STM schedule is being stopped. Atm STM can only stop the schedule at hyperepoch boundaries. This implies that stopping an ongoing schedule might take up to the length of the longest hyperepoch of the current schedule.</li>
<li>All nodes are being notified of the new state name (see <code><a class="el" href="classdw_1_1framework_1_1Node.html#af613cda5bc703967230444bb887c6d6d" title="Set the current state in node. Node implementation of this API need to be thread-safe.">dw::framework::Node::setState()</a></code>). <pre class="fragment">Nodes shouldn't perform any long running task in this function to make the schedule switch as fast as possible.
</pre></li>
<li>The new (or potentially the same) STM schedule is being started.</li>
</ol>
<p >After the schedule switch has been completed SSM is being notified about it.</p>
<p >The following diagram illustrates the schedule manager and how it interacts with SSM as well as with the STM master and the nodes when SSM requests a state change.</p>
<div class="plantumlgraph">
<img src="schedule_switching.png" />
<div class="caption">
Schedule Switching in 3 Steps</div>
</div>
<blockquote class="doxtable">
<p >&zwj;Note: atm the schedule manager doesn't perform the three steps asynchronously but instead synchronously within the state change callback. As a consequence the "Accept Request" response signaled by returning <code>true</code> from that callback only happens at the very end, after the "State Change Completed" has been sent to SSM. </p>
</blockquote>
<h1><a class="anchor" id="references-schedule-switching"></a>
References</h1>
<p >The schema for <a class="el" href="app_8schema_8json.html">.app.json</a> files captures the states and schedules assigned to each state under <code>states</code> and <code>stmSchedules</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
